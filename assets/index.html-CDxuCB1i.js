import{_ as c,c as p,d as e,b as n,a as r,e as s,w as a,r as d,o as k}from"./app-D3VquNP3.js";const g="/bbblog/assets/from_virtualization_to_container-DTtIMDpt.png",u="/bbblog/assets/traditional_microservice_architecture-CnNT0PJK.png",m="/bbblog/assets/Dockerfile-DT2ER7aB.png",y="/bbblog/assets/cache-stack-CG6zJDXr.png",v="/bbblog/assets/cache-stack-invalidated-jilvAiMC.png",f="/bbblog/assets/compose-application-DC5SGma8.webp",b={};function D(A,i){const h=d("CodeTabs"),o=d("RouteLink");return k(),p("div",null,[i[31]||(i[31]=e("h2",{id:"_1-introduction",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#_1-introduction"},[e("span",null,"1. Introduction")])],-1)),i[32]||(i[32]=e("h3",{id:"_1-1-what-is-a-container",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#_1-1-what-is-a-container"},[e("span",null,"1.1 What is a Container?")])],-1)),i[33]||(i[33]=e("ul",null,[e("li",null,[s("In the "),e("b",null,"physical world"),s(", container is a standardized unit of storage in the shipping industry. "),e("u",null,"Standardized containers provide a consistent, predictable unit of storage"),s(" that can be easily transferred to truck or rail transportation. By focusing on containers instead of individual pieces of cargo, we have improved efficiency,increased productivity, and reduced costs for consumers.This is a great example of using "),e("u",null,"abstraction"),s(" to increase agility.")]),e("li",null,[s("While in the "),e("b",null,"virtual world"),s(", a container is "),e("u",null,"a standardized unit of software"),s(" designed to run quickly and reliably on any computing environment that is running the containerization platform.")]),e("li",null,[s("Containers are a form of virtualization that is implemented at the operating system level. "),e("mark",{"!info":""},"Containers are lightweight, standalone packages that include everything needed to run an application"),s(", such as code, runtime, system tools, system libraries, and settings.")]),e("li",null,[s("A single server can host "),e("u",null,"several containers that all share the underlying host system's OS Kernel"),s(". These containers might be services that are part of a larger enterprise application, or they might be separate applications that are running in their isolated environment.")])],-1)),i[34]||(i[34]=n('<h3 id="_1-2-history-of-virtualization" tabindex="-1"><a class="header-anchor" href="#_1-2-history-of-virtualization"><span>1.2 History of Virtualization</span></a></h3><p><u>Technical maturity is often associated with increasec levels of abstraction.</u></p><h4 id="_1-2-1-bare-metal-servers" tabindex="-1"><a class="header-anchor" href="#_1-2-1-bare-metal-servers"><span>1.2.1 Bare-metal servers</span></a></h4><p>Bare metal refers to <mark class="info">a physical computer</mark>, specifically a server, that has one and only one operating system. <u>The distinction is important in modern computing because many, if not most, servers are virtual machines.</u> A physical server is typically a fairly large computer with powerful hardware built-in. Installing an operating system and running applications directly on that physical hardware, without virtualization, is referred to as running on “bare metal.”</p><ul><li>workstyle: With bare metal servers the architectural layers, such as the infrastructure and application software layers are built. For example: you install an operating system on top of your server hardware, install any shared libraries on top of that operating system, and then install your applications that use those libraries.</li><li>downside: <ul><li>it&#39;s massively inefficient: your hardware costs are the same whether you are running at 0% utilization or 100% utilization.</li><li>keep the versions of your libraries <u>in sync with all your applications</u>: lf one application requires an updated version of a library that is incompatible with other applications running on that host, then you run into problems.</li></ul></li></ul><h4 id="_1-2-2-virtual-machines" tabindex="-1"><a class="header-anchor" href="#_1-2-2-virtual-machines"><span>1.2.2 Virtual machines</span></a></h4><p>A virtual machine, commonly shortened to just VM, is no different than any other physical computer like a laptop, smart phone, or server. It has a CPU, memory, disks to store your files, and can connect to the internet if needed. While the parts that make up your computer (called hardware) are physical and tangible, <mark class="info">VMs are often thought of as virtual computers or software-defined computers within physical servers, existing only as code.</mark> Virtual machines (VMs) are a way to run multiple applications on a single server. Each VM runs on top of a <strong>hypervisor</strong>, which is a piece of software that that can carve up the host resources into multiple isolated virtual hardware configuration which you can then treat as their own systems (each with an OS, binaries/libraries, and applications). You can increase agility by <u>putting a <strong>virtualization platform</strong> over the operating system</u>.</p><ul><li>workstyles: Now you have isolated applications and their libraries with their own full operating system into avirtual machine (VM). This improves utilization.</li><li>downside: <ul><li>the virtualization layer is &quot;heavy&quot;: you may have four operating systemson the host instead of one.That means <u>more patching,more updates, significantly more space being taken upon the physical host.</u></li><li>significant redundancy: you&#39;ve installed potentially the same OS four times, and potentially the same library three times.</li></ul></li></ul><h4 id="_1-2-3-containers" tabindex="-1"><a class="header-anchor" href="#_1-2-3-containers"><span>1.2.3 Containers</span></a></h4><p>Containers are a way to run multiple applications on a single server without the overhead of a hypervisor. Each container runs on top of a <strong>container engine</strong> (software that manages the lifecycle of containers), which oversees and isolates processes using the host operating system’s kernel features.</p><ul><li>workstyles: The container runtime shares the operating systems kernel, enabling you to create container images using file system layers.</li><li>advantages: <ul><li>lightweight, efficient, and fast: They can be spun up and spun down faster than virtual machines, allowing for better utilization of the underlying hardware.</li><li>share libraries: You can share libraries when needed, but you can also have library isolation for your applications.</li><li>highly portable: Because containers isolate software from the other layers, their code runs identically across different environments: from development and staging, all the way to production.</li></ul></li></ul><p>::: <img src="'+g+'" alt="alt text" loading="lazy"></p><p>And <mark class="info">Docker</mark> makes CONTAINER popular again.</p><h3 id="_1-3-what-are-the-advantages-of-a-microservice-environment" tabindex="-1"><a class="header-anchor" href="#_1-3-what-are-the-advantages-of-a-microservice-environment"><span>1.3 What are the advantages of a microservice environment?</span></a></h3><h4 id="_1-3-1-traditional-vs-microservice-architecture" tabindex="-1"><a class="header-anchor" href="#_1-3-1-traditional-vs-microservice-architecture"><span>1.3.1 Traditional vs microservice architecture</span></a></h4><ul><li>Traditional architecture Consider this example of atraditional architecture. All the processes for one of the applications are tightly coupled and run as a single service. <ul><li>This means that <u>if one process of the application experiences a spike in demand, the entire architecture must be scaled.</u></li><li>Adding or improving features becomes more complex as the code base grows, which limits experimentation and makes it difficult to implement new ideas.</li><li>Monolithic architectures also add risk for application availability because many dependent and tightly coupled processes increase the impact of a single process failure.</li><li>And you cansee where there is a lot of<u> redundancy of function across different applications.</u></li></ul></li><li>Microservice architecture Now consider the same three applications running ina microservice architecture: <mark class="info">Each application is built as an independent component that runs as a service and communicates by using lightweight APl operations.</mark><ul><li>Each service performs a single function that can support multiple applications.</li><li>We also see <u>a migration away from dedicated servers to an abstracted hardware layer</u> where micro services can be intelligently placed based on needs, such as performance and resilience. <img src="'+u+'" alt="alt text" loading="lazy"></li></ul></li></ul><h4 id="_1-3-2-characteristics-of-microservices" tabindex="-1"><a class="header-anchor" href="#_1-3-2-characteristics-of-microservices"><span>1.3.2 Characteristics of microservices</span></a></h4><ul><li><p>Decentralized,evolutionary design</p><ul><li>Each container uses <mark class="info">the language and technology that is best suited for the functioning of the service</mark> instead of requiring users to use a specific language or a specific technology.</li><li>Each component or system in the architecture is <mark class="info">evolved separately</mark> rather than updating the system in amonolithic style.</li></ul></li><li><p>Smart endpoints, dumb pipes</p><p>There is no enterprise service bus(企业服务总线); data is not transformed when it&#39;s going between services. <mark class="info">The service receiving the data should be smart enough to handle whatever it is sent.</mark></p></li><li><p>Independent products, not projects</p><p>Going against the traditional waterfall project model, think of a microservice as <mark class="info">a separate product with its own inputs and outputs</mark>. Containers help with this by enabling you to package all your dependencies and your libraries into a single immutable object.</p></li><li><p>Designed for failure</p><p>Everything fails all the time. Services are designed to be resilient, redundant, and to handle bad input, or if the service the microservice wants to communicate with is not there.</p></li><li><p>Disposability可处理性</p><p>We start fast, fail fast, and release any file handlers. Containers are added and removed, workloads change, and resources are temporary because they constantly change.</p></li><li><p>Development and production parity对等</p><p><mark class="info">Development, testing and production environments can be made consistent using containers.</mark></p></li></ul><p>To sum it all up,microservices and containers go well together. Containers are the underlying technology that powers modern microservices, and with microservice architectures, developers can take full advantage of containers.</p><h3 id="_1-4-open-container-initiative-oci" tabindex="-1"><a class="header-anchor" href="#_1-4-open-container-initiative-oci"><span>1.4 Open Container Initiative (OCI)</span></a></h3><p>The OCI is an industry collaboration that <mark class="info">aims to create <strong>open industry standards</strong> for container formats and runtimes.</mark> It was founded by companies like Docker, Google, VMware, Microsoft, Dell, IBM, and Oracle.</p><p>The OCI&#39;s primary goal is to ensure the compatibility and interoperability of container environments through three defined technical specifications，which includes:</p><ol><li>Image Specification: Defines the image&#39;s metadata and format, including a serializable file system.</li><li>Runtime Specification: Describes how to run a container using an image adhering to the Image Specification.</li><li>Distribution Specification: Outlines how images should be distributed, such as through registries, pushing, and pulling images.</li></ol><p>Docker is a specific implementation of the OCI standard. When referring to Docker images or Docker container images, it means the Docker implementation of the OCI specification.</p><h2 id="_2-underlying-technologies" tabindex="-1"><a class="header-anchor" href="#_2-underlying-technologies"><span>2. Underlying Technologies</span></a></h2><h3 id="_2-1-namespaces" tabindex="-1"><a class="header-anchor" href="#_2-1-namespaces"><span>2.1 Namespaces</span></a></h3><p>Docker namespaces are a fundamental feature of Linux that <mark class="info">Docker uses to create isolated environments for containers</mark>. They provide a layer of isolation by <u>creating separate instances of global system resources, making each container believe it has its own unique set of resources.</u> Docker utilizes several types of namespaces, including PID (Process ID), NET (Network), MNT (Mount), UTS (Unix Timesharing System), IPC (InterProcess Communication), and USER namespaces and by leveraging these namespaces, Docker can create lightweight, portable, and secure containers that run consistently across different environments.</p><p>The best way to prevent privilege-escalation attacks from within a container is <mark class="info">to configure your container&#39;s applications to run as unprivileged users.</mark> For containers whose processes must run as the root user within the container, you can re-map this user to a less-privileged user on the Docker host. The mapped user is assigned a range of UIDs which function within the namespace as normal UIDs from 0 to 65536, but have no privileges on the host machine itself.</p><h3 id="_2-2-cgroups" tabindex="-1"><a class="header-anchor" href="#_2-2-cgroups"><span>2.2 cgroups</span></a></h3><p>cgroups or &quot;control groups&quot; are a Linux kernel feature that allows you to allocate and manage resources, such as CPU, memory, network bandwidth, and I/O, among groups of processes running on a system. It plays a crucial role in <mark class="info">providing resource isolation and limiting the resources that a running container can use.</mark> Docker utilizes cgroups to <strong>enforce resource constraints on containers</strong>, allowing them to have a consistent and predictable behavior.</p><h3 id="_2-3-union-file-systems" tabindex="-1"><a class="header-anchor" href="#_2-3-union-file-systems"><span>2.3 Union File systems</span></a></h3><p>Union file systems, also known as UnionFS, play a crucial role in the overall functioning of Docker. It&#39;s a unique type of filesystem that <mark class="info">creates a virtual, layered file structure by overlaying multiple directories.</mark> Instead of modifying the original file system or merging directories, UnionFS enables the <strong>simultaneous mounting of multiple directories on a single mount point while keeping their contents separate</strong>. This feature is especially beneficial in the context of Docker, as it allows us to manage and optimize storage performance by minimizing duplication and reducing the container image size.</p><h2 id="_3-docker-basics" tabindex="-1"><a class="header-anchor" href="#_3-docker-basics"><span>3. Docker Basics</span></a></h2><h3 id="_3-1-docker-components" tabindex="-1"><a class="header-anchor" href="#_3-1-docker-components"><span>3.1 Docker Components</span></a></h3><p>There are <mark class="info">3 key components</mark> in the Docker ecosystem:</p><ol><li><p>Dockerfile</p><p>A text file containing instructions (commands) to build a Docker image. Each instruction in a Dockerfile creates <u>a read-only layer</u> in the image, making the container image an immutable object. If you change the Dockerfile and rebuild the image, <mark class="info">only those layers that have changed are rebuilt.</mark> This is part of what makes container images so lightweight, small, and fast, when compared to other virtualization technologies.</p></li><li><p>Docker Image</p><p>A snapshot of a container, <u>created from a Dockerfile</u>. Images are stored in a registry, like Docker Hub, and can be pulled or pushed to the registry. An image is <mark class="info">a read-only template</mark> with instructions for creating a container. <u>A running container is an instance of an image.</u></p><ul><li>You can create images from scratch</li><li>or you can use images that were created by others and published to a public or private registry. An image is usually based on another image, with some customization.</li></ul></li><li><p>Docker Container</p><p>A running instance of a Docker image.</p></li></ol><figure><img src="'+m+`" alt="alt text" tabindex="0" loading="lazy"><figcaption>alt text</figcaption></figure><h3 id="_3-2-docker-commands" tabindex="-1"><a class="header-anchor" href="#_3-2-docker-commands"><span>3.2 Docker Commands</span></a></h3><p>Some essential Docker commands will be used frequently:</p><ul><li><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pull</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">imag</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">e</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Download an image from a registry, like Docker Hub.</p></li><li><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> build</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -t</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">image_nam</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">e</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">pat</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">h</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Build an image from a Dockerfile, where <code>&lt;path&gt;</code> is the directory containing the Dockerfile.</p></li><li><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> image</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ls</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>List all images available on your local machine.</p></li><li><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -d</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">host_por</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">t</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">:</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">container_por</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">t</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --name</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">container_nam</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">e</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">imag</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">e</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Run a container from an image, mapping host ports to container ports.</p></li><li><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> container</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ls</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>List all running containers.</p></li><li><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> container</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> stop</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">containe</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">r</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Stop a running container.</p></li><li><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> container</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> rm</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">containe</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">r</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Remove a stopped container.</p></li><li><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> image</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> rm</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">imag</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">e</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Remove an image from your local machine.</p></li></ul><h2 id="_4-data-persistence-in-docker" tabindex="-1"><a class="header-anchor" href="#_4-data-persistence-in-docker"><span>4. Data Persistence in Docker</span></a></h2><p>When a container starts, it uses the files and configuration provided by the image. Each container is able to create, modify, and delete files and does so without affecting any other containers. When the container is deleted, these file changes are also deleted.</p><p>While this ephemeral nature of containers is great, <mark class="info">it poses a challenge when you want to persist the data</mark>. For example, if you restart a database container, you might not want to start with an empty database. So, how do you persist files?</p><h3 id="_4-1-container-volumes" tabindex="-1"><a class="header-anchor" href="#_4-1-container-volumes"><span>4.1 Container Volumes</span></a></h3><p><mark class="note">Volumes are a storage mechanism that provide the ability to persist data beyond the lifecycle of an individual container.</mark> Think of it like providing a shortcut or symlink from inside the container to outside the container. <mark class="note">And it is created and managed by Docker.</mark>That means When you create a volume, it&#39;s stored within a directory on the Docker host.</p><h4 id="_4-1-1-mounting-a-volume-over-existing-data" tabindex="-1"><a class="header-anchor" href="#_4-1-1-mounting-a-volume-over-existing-data"><span>4.1.1 Mounting a volume over existing data</span></a></h4><ul><li><p>If you mount a <code>non-empty</code> volume into a directory in the container in which files or directories exist, the pre-existing files are <u>obscured by the mount.</u></p><p>This is similar to if you were to save files into /mnt on a Linux host, and then mounted a USB drive into /mnt. The contents of /mnt would be obscured by the contents of the USB drive until the USB drive was unmounted.</p><p>With containers, there&#39;s no straightforward way of removing a mount to reveal the obscured files again. Your best option is to recreate the container without the mount.</p></li><li><p>If you mount an <code>empty</code> volume into a directory in the container in which files or directories exist, these files or directories are <u>propagated (copied) into the volume by default.</u> Similarly, if you start a container and specify a volume which does not already exist, an empty volume is created for you. This is a good way to pre-populate data that another container needs.</p></li><li><p>To prevent Docker from copying a container&#39;s pre-existing files into an empty volume, use the <code>volume-nocopy</code> option.</p></li></ul><h4 id="_4-1-2-named-and-anonymous-volumes" tabindex="-1"><a class="header-anchor" href="#_4-1-2-named-and-anonymous-volumes"><span>4.1.2 Named and anonymous volumes</span></a></h4><p>A volume may be named or anonymous. Anonymous volumes are given a random name that&#39;s guaranteed to be unique within a given Docker host. Just like named volumes, anonymous volumes persist even if you remove the container that uses them, except if you use the <code>--rm</code> flag when creating the container, in which case the anonymous volume associated with the container is destroyed.</p><p>If you create multiple containers consecutively that each use anonymous volumes, each container creates its own volume. Anonymous volumes aren&#39;t reused or shared between containers automatically. To share an anonymous volume between two or more containers, you must mount the anonymous volume using the random volume ID.</p><h4 id="_4-1-3-syntax" tabindex="-1"><a class="header-anchor" href="#_4-1-3-syntax"><span>4.1.3 Syntax</span></a></h4><p>To mount a volume with the <code>docker run </code>command, you can use either the <code>--mount</code> or <code>--volume</code> flag.</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --mount</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> type=volume,src=</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">volume-nam</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">e</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,dst=</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">mount-pat</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">h</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --volume</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">volume-nam</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">e</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">:</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">mount-pat</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">h</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>In general, <mark class="note"><code>--mount</code> is preferred.</mark> The main difference is that the <code>--mount</code> flag is more explicit and supports all the available options.</p><h4 id="_4-1-4-create-and-manage-volumes" tabindex="-1"><a class="header-anchor" href="#_4-1-4-create-and-manage-volumes"><span>4.1.4 Create and manage volumes</span></a></h4><p>Unlike a bind mount, you can create and manage volumes <u>outside the scope of any container.</u></p><ul><li><strong>Create</strong> a volume: create a volume named <code>log-data</code>.<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> volume</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> create</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> log-data</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><strong>List</strong> volumes:<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> volume</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ls</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">local</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">          my-vol</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><strong>Inspect</strong> a volume:<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> volume</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> inspect</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> my-vol</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    {</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">        &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Driver</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">: </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">local</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">        &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Labels</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">: {},</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">        &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Mountpoint</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">: </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/var/lib/docker/volumes/my-vol/_data</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">        &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Name</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">: </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">my-vol</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">        &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Options</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">: {},</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">        &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Scope</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">: </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">local</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    }</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><strong>Remove</strong> a volume:<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> volume</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> rm</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> my-vol</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul><h4 id="_4-1-5-start-a-container-with-a-volume" tabindex="-1"><a class="header-anchor" href="#_4-1-5-start-a-container-with-a-volume"><span>4.1.5 Start a container with a volume</span></a></h4><p>If you start a container with a volume that doesn&#39;t yet exist, Docker will <u>automatically create it</u> for you.</p><p>The following example mounts the volume <code>myvol2</code> into <code>/app/</code> in the container.</p><p>The following <code>-v</code> and <code>--mount</code> examples produce the same result.</p>`,61)),r(h,{id:"515",data:[{id:"--mount"},{id:"-v"}]},{title0:a(({value:t,isActive:l})=>i[0]||(i[0]=[e("span",null,"--mount",-1)])),title1:a(({value:t,isActive:l})=>i[1]||(i[1]=[e("span",null,"-v",-1)])),tab0:a(({value:t,isActive:l})=>i[2]||(i[2]=[e("div",{class:"language-bash line-numbers-mode","data-highlighter":"shiki","data-ext":"bash",style:{"--shiki-light":"#393a34","--shiki-dark":"#dbd7caee","--shiki-light-bg":"#ffffff","--shiki-dark-bg":"#121212"}},[e("pre",{class:"shiki shiki-themes vitesse-light vitesse-dark vp-code"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#59873A","--shiki-dark":"#80A665"}},"docker"),e("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}}," run"),e("span",{style:{"--shiki-light":"#A65E2B","--shiki-dark":"#C99076"}}," -d"),e("span",{style:{"--shiki-light":"#A65E2B","--shiki-dark":"#C99076"}}," \\")]),s(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#A65E2B","--shiki-dark":"#C99076"}},"  --name"),e("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}}," devtest"),e("span",{style:{"--shiki-light":"#A65E2B","--shiki-dark":"#C99076"}}," \\")]),s(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#A65E2B","--shiki-dark":"#C99076"}},"  --mount"),e("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}}," source=myvol2,target=/app"),e("span",{style:{"--shiki-light":"#A65E2B","--shiki-dark":"#C99076"}}," \\")]),s(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}},"  nginx:latest")])])]),e("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"})])],-1)])),tab1:a(({value:t,isActive:l})=>i[3]||(i[3]=[e("div",{class:"language-bash line-numbers-mode","data-highlighter":"shiki","data-ext":"bash",style:{"--shiki-light":"#393a34","--shiki-dark":"#dbd7caee","--shiki-light-bg":"#ffffff","--shiki-dark-bg":"#121212"}},[e("pre",{class:"shiki shiki-themes vitesse-light vitesse-dark vp-code"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#59873A","--shiki-dark":"#80A665"}},"docker"),e("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}}," run"),e("span",{style:{"--shiki-light":"#A65E2B","--shiki-dark":"#C99076"}}," -d"),e("span",{style:{"--shiki-light":"#A65E2B","--shiki-dark":"#C99076"}}," \\")]),s(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#A65E2B","--shiki-dark":"#C99076"}},"  --name"),e("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}}," devtest"),e("span",{style:{"--shiki-light":"#A65E2B","--shiki-dark":"#C99076"}}," \\")]),s(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#A65E2B","--shiki-dark":"#C99076"}},"  -v"),e("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}}," myvol2:/app"),e("span",{style:{"--shiki-light":"#A65E2B","--shiki-dark":"#C99076"}}," \\")]),s(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}},"  nginx:latest")])])]),e("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"})])],-1)])),_:1}),i[35]||(i[35]=n(`<p>When the container runs, <mark class="note">all files it writes into the <code>/app</code> folder will be saved in this volume,</mark> outside of the container. If you delete the container and start a new container using the same volume, the files will still be there.</p><div class="hint-container tip"><p class="hint-container-title">Sharing files using volumes</p><p>You can <u>attach the same volume to multiple containers to share files between containers.</u> This might be helpful in scenarios such as log aggregation, data pipelines, or other event-driven applications.</p></div><h3 id="_4-2-bind-mounts" tabindex="-1"><a class="header-anchor" href="#_4-2-bind-mounts"><span>4.2 Bind mounts</span></a></h3><p>When you use a bind mount, a file or directory <mark class="note">on the host machine</mark> is mounted from the host into a container.</p><p>By contrast, when you use a volume, a new directory is created <u>within Docker&#39;s storage directory on the host machine, and Docker manages that directory&#39;s contents.</u></p><h4 id="_4-2-1-bind-mounting-over-existing-data" tabindex="-1"><a class="header-anchor" href="#_4-2-1-bind-mounting-over-existing-data"><span>4.2.1 Bind-mounting over existing data</span></a></h4><p>If you bind mount file or directory into a directory in the container <u>in which files or directories exist</u>, the pre-existing files are <u>obscured by the mount.</u></p><p>This is similar to if you were to save files into <code>/mnt</code> on a Linux host, and then mounted a USB drive into <code>/mnt</code>. The contents of <code>/mnt</code> would be obscured by the contents of the USB drive until the USB drive was unmounted.</p><p>With containers, there&#39;s no straightforward way of removing a mount to reveal the obscured files again. Your best option is to recreate the container without the mount.</p><h4 id="_4-2-2-considerations-and-constraints" tabindex="-1"><a class="header-anchor" href="#_4-2-2-considerations-and-constraints"><span>4.2.2 Considerations and constraints</span></a></h4><ul><li><p>Bind mounts <mark class="info">have write access</mark> to files on the host by default.</p><p>One side effect of using bind mounts is that you can change the host filesystem via processes running in a container, including creating, modifying, or deleting important system files or directories. This capability can have <u>security implications</u>. For example, it may affect non-Docker processes on the host system.</p><p>You can use the readonly or ro option to prevent the container from writing to the mount.</p></li><li><p>Bind mounts are created to the Docker daemon host, not the client.</p><p>If you&#39;re using a remote Docker daemon, you can&#39;t create a bind mount to access files on the client machine in a container.</p><p>For Docker Desktop, the daemon runs inside a Linux VM, not directly on the native host. Docker Desktop has built-in mechanisms that transparently handle bind mounts, allowing you to share native host filesystem paths with containers running in the virtual machine.</p></li><li><p>Containers with bind mounts are <mark class="info">strongly tied to the host</mark>.</p><p>Bind mounts rely on the host machine&#39;s filesystem <u>having a specific directory structure available</u>. This reliance means that containers with bind mounts <u>may fail if run on a different host without the same directory structure.</u></p></li></ul><h4 id="_4-2-3-syntax" tabindex="-1"><a class="header-anchor" href="#_4-2-3-syntax"><span>4.2.3 Syntax</span></a></h4><p>To create a bind mount, you can use either the <code>--mount</code> or <code>--volume</code> flag.</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --mount</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> type=bind,src=</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">host-pat</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">h</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,dst=</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">container-pat</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">h</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --volume</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">host-pat</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">h</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">:</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">container-pat</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">h</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>In general, <mark class="note"><code>--mount</code> is preferred.</mark> The main difference is that the <code>--mount</code> flag is more explicit and supports all the available options.</p><ul><li><p>If you use <code>--volume</code> to bind-mount a file or directory that <u>does not yet exist</u> on the Docker host, Docker <u>automatically creates</u> the directory on the host for you. It&#39;s always created as a directory.</p></li><li><p><code>--mount</code> <mark class="note">does not automatically create a directory</mark> if the specified mount path does not exist on the host. Instead, it produces an error.</p></li></ul><h4 id="_4-2-4-start-a-container-with-a-bind-mount" tabindex="-1"><a class="header-anchor" href="#_4-2-4-start-a-container-with-a-bind-mount"><span>4.2.4 Start a container with a bind mount</span></a></h4><p>Consider a case where you have a directory <code>source</code> and that when you build the source code, the artifacts are saved into another directory, <code>source/target/</code>. You want the artifacts to be available to the container at <code>/app/</code>, and you want the container to get access to a new build each time you build the source on your development host.</p><p>Use the following command to bind-mount the <code>target/</code> directory into your container at <code>/app/</code>. Run the command from <u>within the <code>source directory</code></u>. The <code>$(pwd)</code> sub-command <u>expands to the current working directory on Linux or macOS hosts.</u> If you&#39;re on Windows, see also <a href="https://docs.docker.com/desktop/troubleshoot-and-support/troubleshoot/topics/" target="_blank" rel="noopener noreferrer">Path conversions on Windows</a>.</p><p>The following <code>-v</code> and <code>--mount</code> examples produce the same result. You can&#39;t run them both unless you remove the <code>devtest</code>container after running the first one.</p>`,20)),r(h,{id:"621",data:[{id:"--mount"},{id:"-v"}]},{title0:a(({value:t,isActive:l})=>i[4]||(i[4]=[e("span",null,"--mount",-1)])),title1:a(({value:t,isActive:l})=>i[5]||(i[5]=[e("span",null,"-v",-1)])),tab0:a(({value:t,isActive:l})=>i[6]||(i[6]=[e("div",{class:"language-bash line-numbers-mode","data-highlighter":"shiki","data-ext":"bash",style:{"--shiki-light":"#393a34","--shiki-dark":"#dbd7caee","--shiki-light-bg":"#ffffff","--shiki-dark-bg":"#121212"}},[e("pre",{class:"shiki shiki-themes vitesse-light vitesse-dark vp-code"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#59873A","--shiki-dark":"#80A665"}},"docker"),e("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}}," run"),e("span",{style:{"--shiki-light":"#A65E2B","--shiki-dark":"#C99076"}}," -d"),e("span",{style:{"--shiki-light":"#A65E2B","--shiki-dark":"#C99076"}}," \\")]),s(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#A65E2B","--shiki-dark":"#C99076"}},"  -it"),e("span",{style:{"--shiki-light":"#A65E2B","--shiki-dark":"#C99076"}}," \\")]),s(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#A65E2B","--shiki-dark":"#C99076"}},"  --name"),e("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}}," devtest"),e("span",{style:{"--shiki-light":"#A65E2B","--shiki-dark":"#C99076"}}," \\")]),s(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#A65E2B","--shiki-dark":"#C99076"}},"  --mount"),e("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}}," type=bind"),e("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}}," source="),e("span",{style:{"--shiki-light":"#B5695977","--shiki-dark":"#C98A7D77"}},'"'),e("span",{style:{"--shiki-light":"#999999","--shiki-dark":"#666666"}},"$("),e("span",{style:{"--shiki-light":"#998418","--shiki-dark":"#B8A965"}},"pwd"),e("span",{style:{"--shiki-light":"#999999","--shiki-dark":"#666666"}},")"),e("span",{style:{"--shiki-light":"#B5695977","--shiki-dark":"#C98A7D77"}},'"'),e("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}},"/target,target=/app"),e("span",{style:{"--shiki-light":"#A65E2B","--shiki-dark":"#C99076"}}," \\")]),s(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}},"  nginx:latest")])])]),e("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"})])],-1)])),tab1:a(({value:t,isActive:l})=>i[7]||(i[7]=[e("div",{class:"language-bash line-numbers-mode","data-highlighter":"shiki","data-ext":"bash",style:{"--shiki-light":"#393a34","--shiki-dark":"#dbd7caee","--shiki-light-bg":"#ffffff","--shiki-dark-bg":"#121212"}},[e("pre",{class:"shiki shiki-themes vitesse-light vitesse-dark vp-code"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#59873A","--shiki-dark":"#80A665"}},"docker"),e("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}}," run"),e("span",{style:{"--shiki-light":"#A65E2B","--shiki-dark":"#C99076"}}," -d"),e("span",{style:{"--shiki-light":"#A65E2B","--shiki-dark":"#C99076"}}," \\")]),s(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#A65E2B","--shiki-dark":"#C99076"}},"  -it"),e("span",{style:{"--shiki-light":"#A65E2B","--shiki-dark":"#C99076"}}," \\")]),s(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#A65E2B","--shiki-dark":"#C99076"}},"  --name"),e("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}}," devtest"),e("span",{style:{"--shiki-light":"#A65E2B","--shiki-dark":"#C99076"}}," \\")]),s(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#A65E2B","--shiki-dark":"#C99076"}},"  -v"),e("span",{style:{"--shiki-light":"#B5695977","--shiki-dark":"#C98A7D77"}},' "'),e("span",{style:{"--shiki-light":"#999999","--shiki-dark":"#666666"}},"$("),e("span",{style:{"--shiki-light":"#998418","--shiki-dark":"#B8A965"}},"pwd"),e("span",{style:{"--shiki-light":"#999999","--shiki-dark":"#666666"}},")"),e("span",{style:{"--shiki-light":"#B5695977","--shiki-dark":"#C98A7D77"}},'"'),e("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}},"/target:/app"),e("span",{style:{"--shiki-light":"#A65E2B","--shiki-dark":"#C99076"}}," \\")]),s(`
`),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}},"  nginx:latest")])])]),e("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"})])],-1)])),_:1}),i[36]||(i[36]=n(`<h3 id="_4-3-difference-between-volumes-and-bind-mounts" tabindex="-1"><a class="header-anchor" href="#_4-3-difference-between-volumes-and-bind-mounts"><span>4.3 Difference between volumes and bind mounts</span></a></h3><h4 id="_4-3-1-when-to-use-bind-mounts" tabindex="-1"><a class="header-anchor" href="#_4-3-1-when-to-use-bind-mounts"><span>4.3.1 When to use bind mounts</span></a></h4><p>Bind mounts are appropriate for the following types of use case:</p><ul><li><p><mark class="note">Sharing source code or build artifacts</mark> between a development environment on the Docker host and a container.</p></li><li><p>When you want to create or generate files in a container and <u>persist the files onto the host&#39;s filesystem</u>.</p></li><li><p>Sharing configuration files <u>from the host machine to containers.</u> This is how Docker provides DNS resolution to containers by default, by mounting <code>/etc/resolv.conf</code> from the host machine into each container.</p></li><li><p>Bind mounts are also available for builds: you can bind mount source code from the host into the build container to test, lint, or compile a project.</p></li></ul><h4 id="_4-3-2-when-to-use-volumes" tabindex="-1"><a class="header-anchor" href="#_4-3-2-when-to-use-volumes"><span>4.3.2 When to use volumes</span></a></h4><p>Volumes are a good choice for the following use cases:</p><ul><li>Volumes are <u>easier to back up or migrate</u> than bind mounts.</li><li>You can manage volumes using Docker CLI commands or the Docker API.</li><li>Volumes work on both Linux and Windows containers.</li><li>Volumes can be more safely shared among multiple containers.</li><li>New volumes can <u>have their content pre-populated by a container or build.</u></li><li>When your application <u>requires high-performance I/O.</u></li></ul><div class="hint-container warning"><p class="hint-container-title">Warning</p><p>Volumes are <strong>not</strong> a good choice if you need to access the files from the host, as the volume is completely managed by Docker. Use bind mounts if you need to access files or directories from both containers and the host.</p></div><h2 id="_5-using-3rd-party-container-images" tabindex="-1"><a class="header-anchor" href="#_5-using-3rd-party-container-images"><span>5. Using 3rd Party Container Images</span></a></h2><h3 id="_5-1-databases" tabindex="-1"><a class="header-anchor" href="#_5-1-databases"><span>5.1 Databases</span></a></h3><p>Using a local containerized database offers flexibility and ease of setup, letting you mirror production environments closely without the overhead of traditional database installations. Docker simplifies this process, enabling you to deploy, manage, and scale databases in isolated containers with just a few commands.</p><p>The following wil use the MySQL image for examples, but the concepts can be applied to other database images.</p><h4 id="_5-1-1-run-a-local-containerized-database" tabindex="-1"><a class="header-anchor" href="#_5-1-1-run-a-local-containerized-database"><span>5.1.1 Run a local containerized database</span></a></h4><p>Most popular database systems, including MySQL, PostgreSQL, and MongoDB, have a Docker Official Image available on Docker Hub. (Though I can&#39;t access the page)</p><p>To run a database container, you can use either the Docker Desktop GUI or CLI. (Just write down how to use CLI)</p><p>To run a container using the CLI, run the following command in a terminal:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --name</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> my-mysql</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -e</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> MYSQL_ROOT_PASSWORD=my-secret-pw</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -e</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> MYSQL_DATABASE=mydb</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -d</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql:latest</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>In this command:</p><ul><li><code>--name my-mysql</code> assigns the name my-mysql to your container for easier reference.</li><li><code>-e MYSQL_ROOT_PASSWORD=my-secret-pw</code> sets the root password for MySQL to my-secret-pw.</li><li><code>-e MYSQL_DATABASE=mydb</code> optionally creates a database named mydb.</li><li><code>-d</code> runs the container in <u>detached mode, meaning it runs in the background</u>.</li><li><code>mysql:latest</code> specifies that you want to use the latest version of the MySQL image.</li></ul><p>To verify that you container is running, run docker ps in a terminal</p><h4 id="_5-1-2-access-the-shell-of-a-containerized-database" tabindex="-1"><a class="header-anchor" href="#_5-1-2-access-the-shell-of-a-containerized-database"><span>5.1.2 Access the shell of a containerized database</span></a></h4><p>When you have a database running inside a Docker container, you may need to <u>access its shell to manage the database, execute commands, or perform administrative tasks.</u> Docker provides a straightforward way to do this using the <code>docker exec</code>command. Additionally, if you prefer a graphical interface, you can use Docker Desktop&#39;s GUI.</p><p>To access the terminal of a MySQL container <strong>using the CLI</strong>, you can use the following <code>docker exec</code> command.</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> exec</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -it</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> my-mysql</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> bash</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>In this command:</p><ul><li><code>docker exec</code> tells Docker you want to <strong>execute a command in a running container</strong>.</li><li><code>-it</code> ensures that the terminal you&#39;re <strong>accessing is interactive</strong>, so you can type commands into it.</li><li><code>my-mysql</code> is the name of your MySQL container. If you named your container differently when you ran it, use that name instead.</li><li><code>bash</code> is <u>the command you want to run inside the container</u>. It opens up a bash shell that lets you interact with the container&#39;s file system and installed applications.</li></ul><p>After executing this command, you will <mark class="info">be given access to the bash shell inside your MySQL container, from which you can manage your MySQL server directly.</mark> You can run <code>exit</code> to return to your terminal.</p><hr><p>Once you&#39;ve accessed the container&#39;s terminal, you can run <u>any tools</u> available in that container. The following example shows using mysql in the container to list the databases.</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"># mysql </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">-</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">u </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">root</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> -</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">p</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">Enter </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">password</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">: my</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">-</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">secret</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">-</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">pw</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">mysql</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> SHOW DATABASES;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">+</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">--------------------+</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">| </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">Database</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">           |</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">+</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">--------------------+</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">| information_schema |</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">| mydb               |</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">| mysql              |</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">| performance_schema |</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">| sys                |</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">+</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">--------------------+</span></span>
<span class="line"><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">5</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> rows</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> in</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> set</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">0</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">00</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> sec)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-1-3-connect-to-a-containerized-database-from-your-host" tabindex="-1"><a class="header-anchor" href="#_5-1-3-connect-to-a-containerized-database-from-your-host"><span>5.1.3 Connect to a containerized database from your host</span></a></h4><p>Connecting to a containerized database from your host machine involves <strong>mapping a port inside the container to a port on your host machine</strong>. This process ensures that the database inside the container is accessible <u>via the host machine&#39;s network</u>. For MySQL, the default port is 3306. By exposing this port, you can use various database management tools or applications on your host machine to interact with your MySQL database.</p><p>Run the following command in a terminal:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 3307:3306</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --name</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> my-mysql</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -e</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> MYSQL_ROOT_PASSWORD=my-secret-pw</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -e</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> MYSQL_DATABASE=mydb</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -d</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql:latest</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>In this command, <code>-p 3307:3306</code> <mark class="note">maps port 3307 on the host to port 3306 in the container.</mark></p><p>To verify the port is mapped, run the following command.</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ps</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>You should see output like the following:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">CONTAINER</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ID</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">   IMAGE</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">          COMMAND</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                  CREATED</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">          STATUS</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">          PORTS</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                               NAMES</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">6eb776cfd73c</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">   mysql:latest</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">   &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">docker-entrypoint.s…</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">   17</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> minutes</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ago</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">   Up</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 17</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> minutes</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">   33060/tcp,</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 0.0.0.0:3307</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">-</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">3306/tcp</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">   my-mysql</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>At this point, <u><strong>any</strong> application running on your host</u> can access the MySQL service in the container at <code>localhost:3307</code>.</p><h4 id="_5-1-4-connect-to-a-containerized-database-from-another-container" tabindex="-1"><a class="header-anchor" href="#_5-1-4-connect-to-a-containerized-database-from-another-container"><span>5.1.4 Connect to a containerized database from another container</span></a></h4><p>Connecting to a containerized database from another container is a common scenario in microservices architecture and during development processes. <strong>Docker&#39;s networking</strong> capabilities make it easy to establish this connection without having to expose the database to the host network. <mark class="note">This is achieved by placing both the database container and the container that needs to access it on the same Docker network.</mark></p><p>As a result, <strong>you should create a network first</strong> and run containers on it. To achieve it:</p><ol><li><p>Run the following command to create a Docker network named my-network.</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> network</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> create</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> my-network</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>Run your database container and <mark class="note">specify the network using the <code>--network</code> option</mark>. This runs the container on the my-network network.</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --name</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> my-mysql</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -e</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> MYSQL_ROOT_PASSWORD=my-secret-pw</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -e</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> MYSQL_DATABASE=mydb</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --network</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> my-network</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -d</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql:latest</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>Run your other containers and specify the network using the <code>--network option</code>. For this example, you&#39;ll run a phpMyAdmin container that can connect to your database.</p><p>Run a phpMyAdmin container. Use the <code>--network</code> option to specify the network, the <code>-p</code> option to let you access the container from your host machine, and the <code>-e</code> option to specify a required environment variable for this image.</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --name</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> my-phpmyadmin</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -d</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --network</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> my-network</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 8080:80</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -e</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> PMA_HOST=my-mysql</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> phpmyadmin</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>Verify that the containers can communicate. For this example, you&#39;ll access phpMyAdmin and verify that it connects to the database.</p></li></ol><ul><li>Open http://localhost:8080 to access your phpMyAdmin container.</li><li>Log in using <code>root</code> as the username and <code>my-secret-pw</code> as the password. You should connect to the MySQL server and see your database listed.</li></ul><p>At this point, <strong>any application running on your <code>my-network</code> container network</strong> can access the MySQL service in the container at <code>my-mysql:3306</code>.</p><h4 id="_5-1-5-persist-database-data-in-a-volume" tabindex="-1"><a class="header-anchor" href="#_5-1-5-persist-database-data-in-a-volume"><span>5.1.5 Persist database data in a volume</span></a></h4><p>Persisting database data in a Docker volume is necessary for ensuring that your data survives container restarts and removals. A Docker volume lets you store database files outside the container&#39;s writable layer, making it possible to upgrade the container, switch bases, and share data without losing it. Here’s how you can attach a volume to your database container using either the Docker CLI or the Docker Desktop GUI.</p><p>To run your database container <strong>with a volume attached</strong>, include the <code>-v</code> option with your <code>docker run</code> command, specifying a volume name and the path where the database stores its data inside the container. If the volume doesn&#39;t exist, Docker automatically creates it for you.</p><p>To run a database container with a volume attached, and then verify that the data persists:</p><ol><li><p>Run the container and attach the volume.</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --name</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> my-mysql</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -e</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> MYSQL_ROOT_PASSWORD=my-secret-pw</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -e</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> MYSQL_DATABASE=mydb</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -v</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> my-db-volume:/var/lib/mysql</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -d</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql:latest</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>This command mounts the volume named <code>my-db-volume</code> to the <code>/var/lib/mysql</code> directory in the container.</p></li><li><p>Create some data in the database. Use the <code>docker exec</code> command to run <code>mysql</code> inside the container and create a table.</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> exec</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> my-mysql</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -u</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> root</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> my-secret-pw</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -e</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">CREATE TABLE IF NOT EXISTS mydb.mytable (column_name VARCHAR(255)); INSERT INTO mydb.mytable (column_name) VALUES (&#39;value&#39;);</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>This command uses the <code>mysql</code> tool in the container to create a table named <code>mytable</code> with a column named <code>column_name</code>, and finally inserts a value of <code>value</code>.</p></li><li><p>Stop and remove the container. Without a volume, the table you created would be lost when removing the container.</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> remove</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --force</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> my-mysql</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>Start a new container with the volume attached. This time, <mark class="note">you don&#39;t need to specify any environment variables as the configuration is saved in the volume</mark>.</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --name</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> my-mysql</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -v</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> my-db-volume:/var/lib/mysql</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -d</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql:latest</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>Verify that the table you created still exists. Use the <code>docker exec</code> command again to run <code>mysql</code> inside the container.</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> exec</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> my-mysql</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -u</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> root</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> my-secret-pw</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -e</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">SELECT * FROM mydb.mytable;</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>This command uses the <code>mysql</code> tool in the container to select all the records from the <code>mytable</code> table.</p><p>You should see output like the following.</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">column_name</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">value</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>At this point, any MySQL container that mounts the <code>my-db-volume</code> will be able to access and save persisted data.</p><h4 id="_5-1-6-build-a-customized-database-image" tabindex="-1"><a class="header-anchor" href="#_5-1-6-build-a-customized-database-image"><span>5.1.6 Build a customized database image</span></a></h4><p>Customizing your database image lets you <strong>include additional configuration, scripts, or tools alongside the base database server</strong>. This is particularly useful for creating a Docker image that matches your specific development or production environment needs. The following example outlines how to build and run a custom MySQL image that includes a table initialization script.</p><p>To build and run your custom image:</p><ol><li><mark class="note">Create a Dockerfile</mark>.</li></ol><ul><li>Create a file named <code>Dockerfile</code> in your project directory. For this example, you can create the <code>Dockerfile</code> in an empty directory of your choice. <u>This file will define how to build your custom MySQL image.</u></li><li>Add the following content to the Dockerfile.<div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># syntax=docker/dockerfile:1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># Use the base image mysql:latest</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> mysql:latest</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># Set environment variables</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">ENV</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> MYSQL_DATABASE mydb</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># Copy custom scripts or configuration files from your host to the container</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">COPY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ./scripts/ /docker-entrypoint-initdb.d/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>In this Dockerfile, you&#39;ve set the environment variable for the MySQL database name. You can also use the <code>COPY</code> instruction to add custom configuration files or scripts into the container. In this example, <mark class="note">files from your host&#39;s <code>./scripts/</code> directory are copied into the container&#39;s <code>/docker-entrypoint-initdb.d/</code> directory</mark>. In this directory, <code>.sh</code>, <code>.sql</code>, and <code>.sql.gz</code> scripts are executed when the container is started for the first time.</li><li>Create a script file to initialize a table in the database. <u>In the directory where your <code>Dockerfile</code> is located, create a subdirectory named <code>scripts</code>,</u> and then create a file named <code>create_table.sql</code> with the following content.<div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">CREATE</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> TABLE</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> IF</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> NOT</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> EXISTS</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> mydb</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">myothertable</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">column_name </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">VARCHAR</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">255</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">INSERT INTO</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> mydb</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">myothertable</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (column_name) </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">VALUES</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">other_value</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>You should now have the following directory structure.<div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>├── your-project-directory/</span></span>
<span class="line"><span>│ ├── scripts/</span></span>
<span class="line"><span>│ │ └── create_table.sql</span></span>
<span class="line"><span>│ └── Dockerfile</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><ol start="2"><li><mark class="note">Build your image</mark>.</li></ol><ul><li>In a terminal, change directory to the directory where your <code>Dockerfile</code> is located.</li><li>Run the following command to build the image.<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> build</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -t</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> my-custom-mysql</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> .</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>In this command, <mark class="note"><code>-t my-custom-mysql</code> tags (names) your new image as <code>my-custom-mysql</code></mark>. The period (.) at the end of the command <mark class="note">specifies the current directory as the context for the build</mark>, where <strong>Docker looks for the Dockerfile and any other files needed for the build</strong>.</li></ul><ol start="3"><li>Run your image. This time, <u>specify your image&#39;s name</u> instead of <code>mysql:latest</code>. Also, you no longer need to specify the <code>MYSQL_DATABASE</code> environment variable as it&#39;s now defined by your Dockerfile.<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --name</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> my-mysql</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -e</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> MYSQL_ROOT_PASSWORD=my-secret-pw</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -d</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> my-custom-mysql</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li>Verify that your container is running with the following command.<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ps</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li>Verify that your initialization script was ran. Run the following command in a terminal to show the contents of the myothertable table.<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> exec</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> my-mysql</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -u</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> root</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> my-secret-pw</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -e</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">SELECT * FROM mydb.myothertable;</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>You should see output like the following.<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">column_name</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">other_value</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>Any container ran using your <code>my-custom-mysql</code> image will have the table initialized when first started.</p><h4 id="_5-1-7-use-docker-compose-to-run-a-database" tabindex="-1"><a class="header-anchor" href="#_5-1-7-use-docker-compose-to-run-a-database"><span>5.1.7 Use Docker Compose to run a database</span></a></h4><p>Docker Compose is a tool for defining and running multi-container Docker applications. With a single command, you can configure all your application&#39;s services (like databases, web apps, etc.) and manage them. In this example, you&#39;ll create a Compose file and use it to run a MySQL database container and a phpMyAdmin container.</p><p>To run your containers with Docker Compose:</p><ol><li>Create a <strong>Docker Compose file</strong>.</li></ol><ul><li><p>Create a file named <code>compose.yaml</code> in your project directory. This file will define the services, networks, and volumes.</p></li><li><p>Add the following content to the <code>compose.yaml</code> file.</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">services</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">db</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    image</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql:latest</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    environment</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    MYSQL_ROOT_PASSWORD</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> my-secret-pw</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    MYSQL_DATABASE</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mydb</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    ports</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 3307:3306</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    volumes</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> my-db-volume:/var/lib/mysql</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">phpmyadmin</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    image</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> phpmyadmin/phpmyadmin:latest</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    environment</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    PMA_HOST</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> db</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    PMA_PORT</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 3306</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    MYSQL_ROOT_PASSWORD</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> my-secret-pw</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    ports</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 8080:80</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    depends_on</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> db</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">volumes</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">my-db-volume</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>For the database service:</p><ul><li><code>db</code> is the name of the service.</li><li><code>image: mysql:latest</code> specifies that the service uses the latest MySQL image from Docker Hub.</li><li><code>environment</code> lists the environment variables used by MySQL to initialize the database, such as the root password and the database name.</li><li><code>ports</code> maps port 3307 on the host to port 3306 in the container, allowing you to connect to the database from your host machine.</li><li><code>volumes</code> mounts <code>my-db-volume</code> to <code>/var/lib/mysql</code> inside the container to persist database data.</li></ul><p>In addition to the database service, there is a phpMyAdmin service. <u>By default Compose sets up a single network for your app. Each container for a service joins the default network and is both reachable by other containers on that network, and discoverable by the service&#39;s name. </u>Therefore, in the <code>PMA_HOST</code> environment variable, you can specify the service name, <code>db</code>, in order to connect to the database service.</p></li></ul><ol start="2"><li>Run Docker Compose.</li></ol><ul><li>Open a terminal and change directory to the directory where your <code>compose.yaml</code> file is located.</li><li>Run Docker Compose using the following command.<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> compose</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> up</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>You can now access phpMyAdmin at http://localhost:8080 and connect to your database using <code>root</code> as the username and <code>my-secret-pw</code> as the password.</li><li>To stop the containers, press <code>ctrl+c</code> in the terminal.</li></ul><p>Now, with Docker Compose you can <u>start your database and app, mount volumes, configure networking, and more,</u> all with a <strong>single</strong> command.</p><h3 id="_5-2-interactive-test-environments" tabindex="-1"><a class="header-anchor" href="#_5-2-interactive-test-environments"><span>5.2 Interactive Test Environments</span></a></h3><h4 id="_5-2-1-source" tabindex="-1"><a class="header-anchor" href="#_5-2-1-source"><span>5.2.1 Source</span></a></h4><p>You can launch a dev environment from a:</p><ul><li>Git repository</li><li>Branch or tag of a Git repository</li><li>Sub-folder of a Git repository</li><li>Local folder</li></ul><p>This does not conflict with any of the local files or local tooling set up on your host.</p><h4 id="_5-2-2-launch-a-dev-environment-from-a-git-repository" tabindex="-1"><a class="header-anchor" href="#_5-2-2-launch-a-dev-environment-from-a-git-repository"><span>5.2.2 Launch a dev environment from a Git repository</span></a></h4><p>To launch a dev environment:</p><ol><li>From the <strong>Dev Environments</strong> tab in Docker Dashboard, select <strong>Create</strong>. The <strong>Create a Dev Environment</strong> dialog displays.</li><li>Select <strong>Get Started</strong>.</li><li>Optional: Provide a name for you dev environment.</li><li>Select <strong>Existing Git repo</strong> as the source and then paste your Git repository link into the field provided: https://github.com/dockersamples/single-dev-env</li><li>Choose your IDE. You can choose either: <ul><li><strong>Visual Studio Code</strong>. The Git repository is cloned into a Volume and attaches to your containers. This allows you to develop directly inside of them using Visual Studio Code.</li><li><strong>Other</strong>. The Git repository is cloned into your chosen local directory and attaches to your containers as a bind mount. This shares the directory from your computer to the container, and allows you to develop using any local editor or IDE.</li></ul></li><li>Select <strong>Continue</strong>.</li></ol><p>To launch the application, run the command <code>make run</code> in your terminal. This opens an http server on port 8080. Open <a href="http://localhost:8080" target="_blank" rel="noopener noreferrer">http://localhost:8080</a> in your browser to see the running application.</p><blockquote><p>Tip</p><p>To use the <code>make</code> command in Windows, try <code>Makefile Tool</code> in VS Code.</p></blockquote><h3 id="_5-3-command-line-utilities" tabindex="-1"><a class="header-anchor" href="#_5-3-command-line-utilities"><span>5.3 Command Line Utilities</span></a></h3><p>About some command line references.</p><ul><li><code>Docker Images ls</code>: List images, most of the options allow users to look into details like digest, image ID, tag, repository, etc. Refer to <a href="https://docs.docker.com/engine/reference/commandline/images/" target="_blank" rel="noopener noreferrer">Docker image ls</a> for more information.</li><li><code>Docker Run</code>: Create and run a new container, pulling the image if needed and starting the container. There are lots of options here, and can&#39;t list all out. Refer to <a href="https://docs.docker.com/reference/cli/docker/container/run/" target="_blank" rel="noopener noreferrer">Docker run</a>.</li><li><code>Docker Image Pull</code>: Download an image from a registry, and options in this command allow users to choose which image should be pulled, using repository/tag/digest and so on. Refer to <a href="https://docs.docker.com/engine/reference/commandline/pull/" target="_blank" rel="noopener noreferrer">Docker image pull</a>.</li></ul><h2 id="_6-building-container-images" tabindex="-1"><a class="header-anchor" href="#_6-building-container-images"><span>6. Building Container Images</span></a></h2><h3 id="_6-1-dockerfiles" tabindex="-1"><a class="header-anchor" href="#_6-1-dockerfiles"><span>6.1 Dockerfiles</span></a></h3><p>Docker can build images automatically by reading the instructions from a Dockerfile. A Dockerfile is a text document that contains all the commands a user could call on the command line to assemble an image.</p><h4 id="_6-1-1-commands-overview" tabindex="-1"><a class="header-anchor" href="#_6-1-1-commands-overview"><span>6.1.1 Commands Overview</span></a></h4><p>The Dockerfile supports the following instructions. And here I would not list all the usages regarding every command, since it&#39;s pretty too long. Refer to <a href="https://docs.docker.com/reference/dockerfile/#overview" target="_blank" rel="noopener noreferrer">Dockerfile Reference</a> to view details:</p><table><thead><tr><th style="text-align:left;">Instruction</th><th style="text-align:left;">Description</th></tr></thead><tbody><tr><td style="text-align:left;"><a href="#add"><code>ADD</code></a></td><td style="text-align:left;">Add local or remote files and directories.</td></tr><tr><td style="text-align:left;"><a href="#arg"><code>ARG</code></a></td><td style="text-align:left;">Use build-time variables.</td></tr><tr><td style="text-align:left;"><a href="#cmd"><code>CMD</code></a></td><td style="text-align:left;">Specify default commands.</td></tr><tr><td style="text-align:left;"><a href="#copy"><code>COPY</code></a></td><td style="text-align:left;">Copy files and directories.</td></tr><tr><td style="text-align:left;"><a href="#entrypoint"><code>ENTRYPOINT</code></a></td><td style="text-align:left;">Specify default executable.</td></tr><tr><td style="text-align:left;"><a href="#env"><code>ENV</code></a></td><td style="text-align:left;">Set environment variables.</td></tr><tr><td style="text-align:left;"><a href="#expose"><code>EXPOSE</code></a></td><td style="text-align:left;">Describe which ports your application is listening on.</td></tr><tr><td style="text-align:left;"><a href="#from"><code>FROM</code></a></td><td style="text-align:left;">Create a new build stage from a base image.</td></tr><tr><td style="text-align:left;"><a href="#healthcheck"><code>HEALTHCHECK</code></a></td><td style="text-align:left;">Check a container&#39;s health on startup.</td></tr><tr><td style="text-align:left;"><a href="#label"><code>LABEL</code></a></td><td style="text-align:left;">Add metadata to an image.</td></tr><tr><td style="text-align:left;"><a href="#maintainer-deprecated"><code>MAINTAINER</code></a></td><td style="text-align:left;">Specify the author of an image.</td></tr><tr><td style="text-align:left;"><a href="#onbuild"><code>ONBUILD</code></a></td><td style="text-align:left;">Specify instructions for when the image is used in a build.</td></tr><tr><td style="text-align:left;"><a href="#run"><code>RUN</code></a></td><td style="text-align:left;">Execute build commands.</td></tr><tr><td style="text-align:left;"><a href="#shell"><code>SHELL</code></a></td><td style="text-align:left;">Set the default shell of an image.</td></tr><tr><td style="text-align:left;"><a href="#stopsignal"><code>STOPSIGNAL</code></a></td><td style="text-align:left;">Specify the system call signal for exiting a container.</td></tr><tr><td style="text-align:left;"><a href="#user"><code>USER</code></a></td><td style="text-align:left;">Set user and group ID.</td></tr><tr><td style="text-align:left;"><a href="#volume"><code>VOLUME</code></a></td><td style="text-align:left;">Create volume mounts.</td></tr><tr><td style="text-align:left;"><a href="#workdir"><code>WORKDIR</code></a></td><td style="text-align:left;">Change working directory.</td></tr></tbody></table><h4 id="_6-1-2-format" tabindex="-1"><a class="header-anchor" href="#_6-1-2-format"><span>6.1.2 Format</span></a></h4><p>Here is the format of the Dockerfile:</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># Comment</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">INSTRUCTION arguments</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>The instruction is <strong>not case-sensitive</strong>. However, convention is for them to be <strong>UPPERCASE</strong> to distinguish them from arguments more easily.</p><p>Docker runs instructions in a Dockerfile <u>in order</u>. A Dockerfile <strong>must begin with a <code>FROM</code> instruction</strong>. This may be after parser directives, comments, and globally scoped ARGs. The <code>FROM</code> instruction specifies the <a href="https://docs.docker.com/glossary/#base-image" target="_blank" rel="noopener noreferrer">base image</a> from which you are building.</p><p>For comments, buildKit treats <u>lines that begin with <code>#</code> as a comment</u>, unless the line is a valid parser directive. A <code>#</code> marker anywhere else in a line is treated as an argument. This allows statements like:</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># Comment</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">RUN</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> echo </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&#39;we are running some # of cool things&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Comment lines are <strong>removed</strong> before the Dockerfile instructions are executed. The comment in the following example is removed before the shell executes the <code>echo</code> command.</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">RUN</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> echo hello \\</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># comment</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">world</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The following examples is equivalent.</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">RUN</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> echo hello \\</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">world</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Comments don&#39;t support line continuation characters.</p><div class="hint-container note"><p class="hint-container-title">Note</p><p><strong>Note on whitespace</strong></p><p>For backward compatibility, leading whitespace before comments (<code>#</code>) and instructions (such as <code>RUN</code>) are ignored, but discouraged. Leading whitespace is not preserved in these cases, and the following examples are therefore equivalent:</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">        # this is a comment-line</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    RUN</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> echo hello</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">RUN</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> echo world</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># this is a comment-line</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">RUN</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> echo hello</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">RUN</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> echo world</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Whitespace in instruction arguments, however, isn&#39;t ignored. The following example prints <code> hello world</code> with leading whitespace as specified:</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">RUN</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> echo </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;\\</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">     hello\\</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">     world&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><h4 id="_6-1-3-parser-directives" tabindex="-1"><a class="header-anchor" href="#_6-1-3-parser-directives"><span>6.1.3 Parser directives</span></a></h4><p>Parser directives are optional, and affect the way in which subsequent lines in a Dockerfile are handled. Parser directives don&#39;t add layers to the build, and don&#39;t show up as build steps. Parser directives are written as a special type of comment in the form <code># directive=value</code>. <strong>A single directive may only be used once.</strong></p><p>The following parser directives are supported:</p><ul><li><code>syntax</code></li><li><code>escape</code></li><li><code>check</code> (since Dockerfile v1.8.0)</li></ul><p><strong>All parser directives must be at the top of a Dockerfile.</strong></p><h5 id="_6-1-3-1-syntax" tabindex="-1"><a class="header-anchor" href="#_6-1-3-1-syntax"><span>6.1.3.1 syntax</span></a></h5><p>Use the <code>syntax</code> parser directive to <u>declare the Dockerfile syntax version to use for the build</u>. If unspecified, BuildKit uses a bundled version of the Dockerfile frontend.</p><p>Most users will want to set this parser directive to <code>docker/dockerfile:1</code>, which causes BuildKit to pull the <mark class="info">latest stable version of the Dockerfile syntax</mark> before the build.</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># syntax=docker/dockerfile:1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>For more information about how the parser directive works, see <a href="https://docs.docker.com/build/buildkit/dockerfile-frontend/" target="_blank" rel="noopener noreferrer">Custom Dockerfile syntax</a>.</p><h5 id="_6-1-3-2-escape" tabindex="-1"><a class="header-anchor" href="#_6-1-3-2-escape"><span>6.1.3.2 escape</span></a></h5><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># escape=\\</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Or</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># escape=\`</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>The <code>escape</code> directive sets the character used to escape characters in a Dockerfile. If not specified, the default escape character is <code>\\</code>.</p><p>The escape character is used both to escape characters in a line, and to escape a newline. This allows a Dockerfile instruction to span multiple lines. Note that regardless of whether the <code>escape</code> parser directive is included in a Dockerfile, escaping is not performed in a <code>RUN</code> command, except at the end of a line.</p><p>Setting the escape character to <code>\`</code> is especially useful on <code>Windows</code>, where <code>\\</code> is the directory path separator. <code>\`</code> is consistent with Windows PowerShell.</p><h5 id="_6-1-3-3-check" tabindex="-1"><a class="header-anchor" href="#_6-1-3-3-check"><span>6.1.3.3 check</span></a></h5><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># check=skip=&lt;checks|all&gt;</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># check=error=&lt;boolean&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>The <code>check</code> directive is used to configure how build checks are evaluated. By default, all checks are run, and failures are treated as warnings.</p><p>You can disable specific checks using <code>#check=skip=&lt;check-name&gt;</code>. To specify multiple checks to skip, separate them with a comma:</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># check=skip=JSONArgsRecommended,StageNameCasing</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>To disable all checks, use <code>#check=skip=all</code>.</p><h4 id="_6-1-2-building-best-practices" tabindex="-1"><a class="header-anchor" href="#_6-1-2-building-best-practices"><span>6.1.2 Building best practices</span></a></h4><h5 id="_6-1-2-1-use-multi-stage-builds" tabindex="-1"><a class="header-anchor" href="#_6-1-2-1-use-multi-stage-builds"><span>6.1.2.1 Use <strong>multi-stage builds</strong></span></a></h5><p>Multi-stage builds let you reduce the size of your final image, by creating a cleaner separation between the building of your image and the final output. Split your Dockerfile instructions into distinct stages to make sure that the resulting output only contains the files that are needed to run the application.</p><p>Using multiple stages can also let you build more efficiently by executing build steps in parallel.</p><h5 id="_6-1-2-2-create-reusable-stages" tabindex="-1"><a class="header-anchor" href="#_6-1-2-2-create-reusable-stages"><span>6.1.2.2 Create reusable stages</span></a></h5><p>If you have multiple images with a lot in common, consider <strong>creating a reusable stage that includes the shared components</strong>, and basing your unique stages on that. Docker only needs to build the common stage once. This means that your derivative images use memory on the Docker host more efficiently and load more quickly.</p><p>It&#39;s also easier to maintain a common base stage (&quot;Don&#39;t repeat yourself&quot;), than it is to have multiple different stages doing similar things.</p><h5 id="_6-1-2-3-choose-the-right-base-image" tabindex="-1"><a class="header-anchor" href="#_6-1-2-3-choose-the-right-base-image"><span>6.1.2.3 Choose the right base image</span></a></h5><p>The first step towards achieving a secure image is to choose the right base image. When choosing an image, ensure it&#39;s built from a trusted source and keep it small.</p><ul><li><a href="https://hub.docker.com/search?image_filter=official" target="_blank" rel="noopener noreferrer">Docker Official Images</a> are a curated collection that have clear documentation, promote best practices, and are regularly updated. They provide a trusted starting point for many applications.</li><li><a href="https://hub.docker.com/search?image_filter=store" target="_blank" rel="noopener noreferrer">Verified Publisher</a> images are high-quality images published and maintained by the organizations partnering with Docker, with Docker verifying the authenticity of the content in their repositories.</li><li><a href="https://hub.docker.com/search?image_filter=open_source" target="_blank" rel="noopener noreferrer">Docker-Sponsored Open Source</a> are published and maintained by open source projects sponsored by Docker through an open source program.</li></ul><p>You should also consider using two types of base image: one for building and unit testing, and another (typically slimmer) image for production. In the later stages of development, your image may not require build tools such as compilers, build systems, and debugging tools. A small image with minimal dependencies can considerably lower the attack surface.</p><h5 id="_6-1-2-4-rebuild-your-images-often" tabindex="-1"><a class="header-anchor" href="#_6-1-2-4-rebuild-your-images-often"><span>6.1.2.4 Rebuild your images often</span></a></h5><p>Docker images are immutable. Building an image is taking a snapshot of that image at that moment. That includes any base images, libraries, or other software you use in your build. <u>To keep your images up-to-date and secure, make sure to rebuild your image often, with updated dependencies.</u></p><p>To ensure that you&#39;re getting the latest versions of dependencies in your build, you can use the <code>--no-cache</code> option to avoid cache hits.</p><div class="language-console line-numbers-mode" data-highlighter="shiki" data-ext="console" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> docker build --no-cache -t my-image:my-tag </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>The following Dockerfile uses the <code>24.04</code> tag of the <code>ubuntu</code> image. Over time, that tag may resolve to a different underlying version of the <code>ubuntu</code> image, as the publisher rebuilds the image with new security patches and updated libraries. Using the <code>--no-cache</code>, you can avoid cache hits and ensure a fresh download of base images and dependencies.</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># syntax=docker/dockerfile:1</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ubuntu:24.04</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">RUN</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> apt-get -y update &amp;&amp; apt-get install -y --no-install-recommends python3</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_6-1-2-5-exclude-with-dockerignore" tabindex="-1"><a class="header-anchor" href="#_6-1-2-5-exclude-with-dockerignore"><span>6.1.2.5 Exclude with .dockerignore</span></a></h5><p>To exclude files not relevant to the build, without restructuring your source repository, use a <code>.dockerignore</code> file. This file supports exclusion patterns similar to <code>.gitignore</code> files.</p><p>For example, to exclude all files with the <code>.md</code> extension:</p><div class="language-plaintext line-numbers-mode" data-highlighter="shiki" data-ext="plaintext" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>*.md</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>`,145)),e("p",null,[i[9]||(i[9]=s("For information on creating one, see ")),r(o,{to:"/manuals/build/concepts/context.html#dockerignore-files"},{default:a(()=>i[8]||(i[8]=[s("Dockerignore file")])),_:1}),i[10]||(i[10]=s("."))]),i[37]||(i[37]=n('<h5 id="_6-1-2-6-create-ephemeral-containers" tabindex="-1"><a class="header-anchor" href="#_6-1-2-6-create-ephemeral-containers"><span>6.1.2.6 Create ephemeral containers</span></a></h5><p>The image defined by your Dockerfile should generate containers that are as ephemeral as possible. Ephemeral means that the container can be stopped and destroyed, then rebuilt and replaced with an absolute minimum set up and configuration.</p><p>Refer to <a href="https://12factor.net/processes" target="_blank" rel="noopener noreferrer">Processes</a> under <em>The Twelve-factor App</em> methodology to get a feel for the motivations of running containers in such a stateless fashion.</p><h5 id="_6-1-2-7-don-t-install-unnecessary-packages" tabindex="-1"><a class="header-anchor" href="#_6-1-2-7-don-t-install-unnecessary-packages"><span>6.1.2.7 Don&#39;t install unnecessary packages</span></a></h5><p>Avoid installing extra or unnecessary packages just because they might be nice to have. For example, you don’t need to include a text editor in a database image.</p><p>When you avoid installing extra or unnecessary packages, your images have reduced complexity, reduced dependencies, reduced file sizes, and reduced build times.</p><h5 id="_6-1-2-8-decouple-applications" tabindex="-1"><a class="header-anchor" href="#_6-1-2-8-decouple-applications"><span>6.1.2.8 <strong>Decouple</strong> applications</span></a></h5><p>Each container should have only one concern. Decoupling applications into multiple containers makes it easier to scale horizontally and reuse containers.</p><p>For instance, a web application stack might consist of three separate containers, each with its own unique image, to manage the web application, database, and an in-memory cache in a decoupled manner.</p>',9)),e("p",null,[i[12]||(i[12]=s("Use your best judgment to keep containers as clean and modular as possible. If containers depend on each other, you can use ")),r(o,{to:"/manuals/engine/network/_index.html"},{default:a(()=>i[11]||(i[11]=[s("Docker container networks")])),_:1}),i[13]||(i[13]=s(" to ensure that these containers can communicate."))]),i[38]||(i[38]=n(`<h5 id="_6-1-2-9-sort-multi-line-arguments" tabindex="-1"><a class="header-anchor" href="#_6-1-2-9-sort-multi-line-arguments"><span>6.1.2.9 Sort multi-line arguments</span></a></h5><p>Whenever possible, sort multi-line arguments <strong>alphanumerically</strong> to make maintenance easier. This helps to avoid duplication of packages and make the list much easier to update. This also makes PRs a lot easier to read and review. Adding a space before a backslash (<code>\\</code>) helps as well.</p><p>Here’s an example from the <a href="https://github.com/docker-library/buildpack-deps" target="_blank" rel="noopener noreferrer">buildpack-deps image</a>:</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">RUN</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> apt-get update &amp;&amp; apt-get install -y --no-install-recommends \\</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  bzr \\</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  cvs \\</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  git \\</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  mercurial \\</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  subversion \\</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  &amp;&amp; rm -rf /var/lib/apt/lists/*</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_6-1-2-10-leverage-build-cache" tabindex="-1"><a class="header-anchor" href="#_6-1-2-10-leverage-build-cache"><span>6.1.2.10 Leverage build cache</span></a></h5><p>When building an image, Docker steps through the instructions in your Dockerfile, executing each in the order specified. <u>For each instruction, Docker checks whether it can reuse the instruction from the build cache.</u></p>`,6)),e("p",null,[i[15]||(i[15]=s("For more information about the Docker build cache and how to optimize your builds, see ")),r(o,{to:"/manuals/build/cache/_index.html"},{default:a(()=>i[14]||(i[14]=[s("Docker build cache")])),_:1}),i[16]||(i[16]=s("."))]),i[39]||(i[39]=n(`<h5 id="_6-1-2-11-pin-base-image-versions" tabindex="-1"><a class="header-anchor" href="#_6-1-2-11-pin-base-image-versions"><span>6.1.2.11 Pin base image versions</span></a></h5><p>Image tags are mutable, meaning a publisher can update a tag to point to a new image. This is useful because it lets publishers update tags to point to newer versions of an image. And as an image consumer, it means you automatically get the new version when you re-build your image.</p><p>For example, if you specify <code>FROM alpine:3.21</code> in your Dockerfile, <code>3.21</code> resolves to the latest patch version for <code>3.21</code>.</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># syntax=docker/dockerfile:1</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> alpine:3.21</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>At one point in time, the <code>3.21</code> tag might point to version 3.21.1 of the image. If you rebuild the image 3 months later, <u>the same tag might point to a different version, such as 3.19.4.</u> This publishing workflow is best practice, and most publishers use this tagging strategy, but it isn&#39;t enforced.</p><p>The downside with this is that <u>you&#39;re not guaranteed to get the same for every build.</u> This could result in breaking changes, and it means you also don&#39;t have an audit trail of the exact image versions that you&#39;re using.</p>`,6)),i[40]||(i[40]=e("p",null,[s("To fully secure your supply chain integrity, you can "),e("mark",{tip:""},"pin the image version to a specific digest."),s(" By pinning your images to a digest, you're guaranteed to always use the same image version, even if a publisher replaces the tag with a new image.")],-1)),i[41]||(i[41]=n(`<p>For example, the following Dockerfile pins the Alpine image to the same tag as earlier, <code>3.21</code>, but this time with a digest reference as well.</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># syntax=docker/dockerfile:1</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> alpine:3.21@sha256:a8560b36e8b8210634f77d9f7f9efd7ffa463e380b75e2e74aff4511df3ef88c</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>With this Dockerfile, even if the publisher updates the <code>3.21</code> tag, your builds would still use the pinned image version: <code>a8560b36e8b8210634f77d9f7f9efd7ffa463e380b75e2e74aff4511df3ef88c</code>.</p><p>While this helps you avoid unexpected changes, it&#39;s also more tedious to have to look up and include the image digest for base image versions manually each time you want to update it. And you&#39;re opting out of automated security fixes, which is likely something you want to get.</p><h5 id="_6-1-2-12-build-and-test-your-images-in-ci" tabindex="-1"><a class="header-anchor" href="#_6-1-2-12-build-and-test-your-images-in-ci"><span>6.1.2.12 Build and test your images in CI</span></a></h5>`,5)),e("p",null,[i[18]||(i[18]=s("When you check in a change to source control or create a pull request, use ")),r(o,{to:"/Monthly%20in-depth%20topic/ci/github-actions/_index.html"},{default:a(()=>i[17]||(i[17]=[s("GitHub Actions")])),_:1}),i[19]||(i[19]=s(" or another CI/CD pipeline to automatically build and tag a Docker image and test it."))]),i[42]||(i[42]=n(`<h4 id="_6-1-3-dockerfile-examples" tabindex="-1"><a class="header-anchor" href="#_6-1-3-dockerfile-examples"><span>6.1.3 Dockerfile Examples</span></a></h4><p>It <strong>must</strong> be a useful tool for me.</p><p><a href="https://github.com/dockersamples" target="_blank" rel="noopener noreferrer">Dockerfile Examples</a></p><h3 id="_6-2-efficient-layer-caching" tabindex="-1"><a class="header-anchor" href="#_6-2-efficient-layer-caching"><span>6.2 Efficient Layer Caching</span></a></h3><p>When you build the same Docker image multiple times, knowing how to optimize the build cache is a great tool for making sure the builds run fast.</p><p>So, <strong>how does the build cache work</strong>?</p><p>The following example shows a small Dockerfile for a program written in C.</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># syntax=docker/dockerfile:1</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ubuntu:latest</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">RUN</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> apt-get update &amp;&amp; apt-get install -y build-essentials</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">COPY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> main.c Makefile /src/</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">WORKDIR</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> /src/</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">RUN</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> make build</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><mark class="info">Each instruction in this Dockerfile translates to a layer</mark> in your final image. You can think of image layers as a <em>stack</em>, with each layer adding more content on top of the layers that came before it: <img src="`+y+'" alt="Image layer diagram" loading="lazy"> Whenever a layer changes, that layer will need to be re-built. For example, suppose you make a change to your program in the <code>main.c</code> file. After this change, the <code>COPY</code> command will have to run again in order for those changes to appear in the image. In other words, Docker will invalidate the cache for this layer.</p><p>If a layer changes, <mark class="tip">all other layers that come after it are also affected</mark>. When the layer with the <code>COPY</code> command gets invalidated, all layers that follow will need to run again, too: <img src="'+v+`" alt="Image layer diagram, showing cache invalidation" loading="lazy"></p><p>And that&#39;s the Docker build cache in a nutshell. Once a layer changes, then <u>all downstream layers need to be rebuilt as well</u>. Even if they wouldn&#39;t build anything differently, they still need to re-run.</p><h3 id="_6-3-image-size-and-security" tabindex="-1"><a class="header-anchor" href="#_6-3-image-size-and-security"><span>6.3 Image Size and Security</span></a></h3><h4 id="_6-3-1-multi-stage-builds" tabindex="-1"><a class="header-anchor" href="#_6-3-1-multi-stage-builds"><span>6.3.1 Multi-stage builds</span></a></h4><p>Multi-stage builds are useful to anyone who has struggled to optimize Dockerfiles while keeping them easy to read and maintain.</p><h5 id="_6-3-1-1-use-multi-stage-builds" tabindex="-1"><a class="header-anchor" href="#_6-3-1-1-use-multi-stage-builds"><span>6.3.1.1 Use multi-stage builds</span></a></h5><p>With multi-stage builds, you use <strong>multiple <code>FROM</code> statements</strong> in your Dockerfile. Each <code>FROM</code> instruction can use a different base, and <mark class="tip">each of them begins a new stage of the build</mark>. You can selectively copy artifacts from one stage to another, leaving behind everything you don&#39;t want in the final image.</p><p>The following Dockerfile has two separate stages: one for building a binary,and <u>another where the binary gets copied from the first stage into the next stage</u>.</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># syntax=docker/dockerfile:1</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> golang:{{% param &quot;example_go_version&quot; %}}</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">WORKDIR</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> /src</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">COPY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> &lt;&lt;EOF ./main.go</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">package main</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">import </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">func main() {</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  fmt.Println(</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;hello, world&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">}</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">EOF</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">RUN</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> go build -o /bin/hello ./main.go</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> scratch</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">COPY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> --from=0 /bin/hello /bin/hello</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">CMD</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> [</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;/bin/hello&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You only need the <strong>single</strong> Dockerfile. No need for a separate build script. Just run <code>docker build</code>.</p><div class="language-console line-numbers-mode" data-highlighter="shiki" data-ext="console" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> docker build -t hello </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>The end result is a tiny production image with nothing but the binary inside.None of the build tools required to build the application are included in the resulting image.</p><p>How does it work? The second <code>FROM</code> instruction starts a new build stage with the <code>scratch</code> image as its base. <strong>The <code>COPY --from=0</code> line copies just the built artifact from the previous stage into this new stage.</strong> The Go SDK and any intermediate artifacts are left behind, and not saved in the final image.</p><h5 id="_6-3-1-2-name-your-build-stages" tabindex="-1"><a class="header-anchor" href="#_6-3-1-2-name-your-build-stages"><span>6.3.1.2 Name your build stages</span></a></h5><p>By default, the stages aren&#39;t named, and you refer to them by their integer number, starting with 0 for the first <code>FROM</code> instruction. However, you can name your stages, by adding an <code>AS &lt;NAME&gt;</code> to the <code>FROM</code> instruction. This example improves the previous one by naming the stages and using the name in the <code>COPY</code> instruction. This means that even if the instructions in your Dockerfile are re-ordered later, the <code>COPY</code> doesn&#39;t break.</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># syntax=docker/dockerfile:1</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> golang:{{% param &quot;example_go_version&quot; %}} </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">AS</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> build</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">WORKDIR</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> /src</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">COPY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> &lt;&lt;EOF /src/main.go</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">package main</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">import </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">func main() {</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  fmt.Println(</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;hello, world&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">}</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">EOF</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">RUN</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> go build -o /bin/hello ./main.go</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> scratch</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">COPY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> --from=build /bin/hello /bin/hello</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">CMD</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> [</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;/bin/hello&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_6-3-1-3-stop-at-a-specific-build-stage" tabindex="-1"><a class="header-anchor" href="#_6-3-1-3-stop-at-a-specific-build-stage"><span>6.3.1.3 Stop at a specific build stage</span></a></h5><p>When you build your image, you don&#39;t necessarily need to build the entire Dockerfile including every stage. You can <strong>specify a target build stage</strong>. The following command assumes you are using the previous <code>Dockerfile</code> but <u>stops at the stage named <code>build</code></u>:</p><div class="language-console line-numbers-mode" data-highlighter="shiki" data-ext="console" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> docker build --target build -t hello </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>A few scenarios where this might be useful are:</p><ul><li>Debugging a specific build stage</li><li>Using a <code>debug</code> stage with all debugging symbols or tools enabled, and a lean <code>production</code> stage</li><li>Using a <code>testing</code> stage in which your app gets populated with test data, but building for production using a different stage which uses real data</li></ul><h5 id="_6-3-1-4-use-an-external-image-as-a-stage" tabindex="-1"><a class="header-anchor" href="#_6-3-1-4-use-an-external-image-as-a-stage"><span>6.3.1.4 Use an external image as a stage</span></a></h5><p>When using multi-stage builds, <mark class="tip">you aren&#39;t limited to copying from stages you created earlier in your Dockerfile.</mark> You can use the <code>COPY --from</code> instruction to <strong>copy from a separate image</strong>, either using the <strong>local image name, a tag available locally or on a Docker registry, or a tag ID</strong>. The Docker client pulls the image if necessary and copies the artifact from there. The syntax is:</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">COPY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> --from=nginx:latest /etc/nginx/nginx.conf /nginx.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h5 id="_6-3-1-5-use-a-previous-stage-as-a-new-stage" tabindex="-1"><a class="header-anchor" href="#_6-3-1-5-use-a-previous-stage-as-a-new-stage"><span>6.3.1.5 Use a previous stage as a new stage</span></a></h5><p>You can pick up where a previous stage left off by referring to it when using the <code>FROM</code> directive. For example:</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># syntax=docker/dockerfile:1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> alpine:latest </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">AS</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> builder</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">RUN</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> apk --no-cache add build-base</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> builder </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">AS</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> build1</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">COPY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> source1.cpp source.cpp</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">RUN</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> g++ -o /binary source.cpp</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> builder </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">AS</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> build2</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">COPY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> source2.cpp source.cpp</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">RUN</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> g++ -o /binary source.cpp</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_6-3-1-6-differences-between-legacy-builder-and-buildkit" tabindex="-1"><a class="header-anchor" href="#_6-3-1-6-differences-between-legacy-builder-and-buildkit"><span>6.3.1.6 Differences between legacy builder and BuildKit</span></a></h5><p>The <strong>legacy</strong> Docker Engine builder processes <strong>all stages of a Dockerfile leading up to the selected <code>--target</code>.</strong> It will build a stage even if the selected target <u>doesn&#39;t depend on that stage</u>.</p><p>BuildKit <u>only builds the stages that the target stage depends on</u>.</p><p>For example, given the following Dockerfile:</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># syntax=docker/dockerfile:1</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ubuntu </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">AS</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> base</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">RUN</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> echo </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;base&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> base </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">AS</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> stage1</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">RUN</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> echo </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;stage1&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> base </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">AS</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> stage2</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">RUN</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> echo </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;stage2&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>With BuildKit enabled, building the <code>stage2</code> target in this Dockerfile means <u>only <code>base</code> and <code>stage2</code> are processed. There is no dependency on <code>stage1</code>, so it&#39;s skipped</u>.</p><div class="language-console line-numbers-mode" data-highlighter="shiki" data-ext="console" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> DOCKER_BUILDKIT</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">1</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> build</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --no-cache</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Dockerfile</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --target</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> stage2</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> .</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">[+] Building 0.4s (7/7) FINISHED                                                                    </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> =&gt; [internal] load build definition from Dockerfile                                            0.0s</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> =&gt; =&gt; transferring dockerfile: 36B                                                             0.0s</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> =&gt; [internal] load .dockerignore                                                               0.0s</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> =&gt; =&gt; transferring context: 2B                                                                 0.0s</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> =&gt; [internal] load metadata for docker.io/library/ubuntu:latest                                0.0s</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> =&gt; CACHED [base 1/2] FROM docker.io/library/ubuntu                                             0.0s</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> =&gt; [base 2/2] RUN echo &quot;base&quot;                                                                  0.1s</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> =&gt; [stage2 1/1] RUN echo &quot;stage2&quot;                                                              0.2s</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> =&gt; exporting to image                                                                          0.0s</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> =&gt; =&gt; exporting layers                                                                         0.0s</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> =&gt; =&gt; writing image sha256:f55003b607cef37614f607f0728e6fd4d113a4bf7ef12210da338c716f2cfd15    0.0s</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>On the other hand, building the same target without BuildKit results in <u>all stages being processed</u>:</p><div class="language-console line-numbers-mode" data-highlighter="shiki" data-ext="console" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> DOCKER_BUILDKIT</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">0</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> build</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --no-cache</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Dockerfile</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --target</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> stage2</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> .</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Sending build context to Docker daemon  219.1kB</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Step 1/6 : FROM ubuntu AS base</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ---&gt; a7870fd478f4</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Step 2/6 : RUN echo &quot;base&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ---&gt; Running in e850d0e42eca</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">base</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Removing intermediate container e850d0e42eca</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ---&gt; d9f69f23cac8</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Step 3/6 : FROM base AS stage1</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ---&gt; d9f69f23cac8</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Step 4/6 : RUN echo &quot;stage1&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ---&gt; Running in 758ba6c1a9a3</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">stage1</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Removing intermediate container 758ba6c1a9a3</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ---&gt; 396baa55b8c3</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Step 5/6 : FROM base AS stage2</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ---&gt; d9f69f23cac8</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Step 6/6 : RUN echo &quot;stage2&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ---&gt; Running in bbc025b93175</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">stage2</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Removing intermediate container bbc025b93175</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ---&gt; 09fc3770a9c4</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Successfully built 09fc3770a9c4</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The legacy builder <u>processes <code>stage1</code>, even if <code>stage2</code> doesn&#39;t depend on it</u>.</p><h4 id="_6-3-2-security" tabindex="-1"><a class="header-anchor" href="#_6-3-2-security"><span>6.3.2 Security</span></a></h4><p>For security thing, refer to link below: <a href="https://app.daily.dev/tags/security?ref=roadmapsh" target="_blank" rel="noopener noreferrer">Explore top posts about Security</a></p><h2 id="_7-container-registries" tabindex="-1"><a class="header-anchor" href="#_7-container-registries"><span>7. Container Registries</span></a></h2><p>A Container Registry is a centralized storage and distribution system for Docker container images. It allows developers to easily share and deploy applications in the form of these images. Container registries play a crucial role in the deployment of containerized applications, as they provide a fast, reliable, and secure way to distribute container images across various production environments.</p><h3 id="_7-1-dockerhub" tabindex="-1"><a class="header-anchor" href="#_7-1-dockerhub"><span>7.1 DockerHub</span></a></h3><p>Docker Hub is a cloud-based registry service that serves as the primary public repository for Docker container images. It allows users to store, share, and distribute Docker images, offering both free public repositories and paid private ones and integrates seamlessly with Docker CLI, enabling easy pushing and pulling of images. It features <strong>official images maintained by software vendors</strong>, automated builds linked to source code repositories, and webhooks for triggering actions based on repository events.</p><h4 id="_7-1-1-dockerhub" tabindex="-1"><a class="header-anchor" href="#_7-1-1-dockerhub"><span>7.1.1 DockerHub</span></a></h4><p>It is a useful tool, but I don&#39;t have access to it, so I just put its link here: <a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer">DockerHub</a></p><h4 id="_7-1-2-dockerhub-repositories" tabindex="-1"><a class="header-anchor" href="#_7-1-2-dockerhub-repositories"><span>7.1.2 DockerHub Repositories</span></a></h4><p>A Docker Hub repository is a collection of container images, enabling you to store, manage, and share Docker images publicly or privately. Each repository serves as a dedicated space where you can store images associated with a particular application, microservice, or project. <strong>Content in repositories is organized by tags</strong>, which represent different versions of the same application, allowing users to pull the right version when needed.</p><p>Refer to <a href="https://docs.docker.com/docker-hub/repos/" target="_blank" rel="noopener noreferrer">this link</a> to learn how to create/manage/archive/delete a repository in detail.</p><h4 id="_7-1-3-dockerhub-webhooks" tabindex="-1"><a class="header-anchor" href="#_7-1-3-dockerhub-webhooks"><span>7.1.3 DockerHub Webhooks</span></a></h4><p>You can use webhooks to cause an action in another service in response to a push event in the repository. Webhooks are POST requests sent to a URL you define in Docker Hub.</p><p>Refer to <a href="https://docs.docker.com/docker-hub/repos/manage/webhooks/" target="_blank" rel="noopener noreferrer">this link</a> to learn how to create or view a webhook in detail.</p><h3 id="_7-2-dockerhub-alternatives" tabindex="-1"><a class="header-anchor" href="#_7-2-dockerhub-alternatives"><span>7.2 DockerHub Alternatives</span></a></h3><p>Container images can be stored in many different registries, not just Dockerhub. Most major cloud platforms now provide container registries such as <mark class="tip">&quot;Artifact Registry&quot; on Google Cloud Platform, Elastic Container Registry on AWS and Azure Container Registry on Microsoft Azure. GitHub also provides it&#39;s own registry which is useful when container builds are included in your GitHub Actions workflow.</mark></p><p>List relative link here for these 4 registries mentioned above:</p><ul><li><a href="https://cloud.google.com/artifact-registry" target="_blank" rel="noopener noreferrer">Artifact Registry on Google Cloud Platform</a></li><li><a href="https://aws.amazon.com/ecr/" target="_blank" rel="noopener noreferrer">Elastic Container Registry on AWS</a></li><li><a href="https://azure.microsoft.com/en-in/products/container-registry" target="_blank" rel="noopener noreferrer">Azure Container Registry on Microsoft Azure</a></li><li><a href="https://docs.github.com/en/packages/guides/about-github-container-registry" target="_blank" rel="noopener noreferrer">GitHub Container Registry on GitHub</a></li></ul><h3 id="_7-3-image-tagging-best-practices" tabindex="-1"><a class="header-anchor" href="#_7-3-image-tagging-best-practices"><span>7.3 Image Tagging Best Practices</span></a></h3><p>Docker image tagging best practices center on <strong>creating clear, consistent, and informative labels</strong>. To ensure efficient image management and improve collaboration across your organization, try practices like:</p><ul><li>Adopt <strong>semantic versioning</strong> for releases</li><li>Avoid the ambiguous &quot;latest&quot; tag in production</li><li>Include relevant metadata like build dates or Git commit hashes</li><li>Implement a strategy distinguishing between environments</li><li>Use descriptive tags for variants</li><li>Automate tagging in CI/CD pipelines</li><li>Regularly clean up old tags</li><li>Document your conventions to maintain clarity and facilitate team-wide adoption.</li></ul><h4 id="_7-3-1-build-tag-and-publish-an-image" tabindex="-1"><a class="header-anchor" href="#_7-3-1-build-tag-and-publish-an-image"><span>7.3.1 Build, tag, and publish an image</span></a></h4><p>In this guide, you will learn the following:</p><ul><li><strong>Building</strong> images - the process of building an image based on a <code>Dockerfile</code></li><li><strong>Tagging</strong> images - the process of <u>giving an image a name, which also determines where the image can be distributed</u></li><li><strong>Publishing</strong> images - the process to distribute or share the newly created image using a container registry</li></ul><h5 id="_7-3-1-1-building-images" tabindex="-1"><a class="header-anchor" href="#_7-3-1-1-building-images"><span>7.3.1.1 Building images</span></a></h5><p>Most often, images are built using a Dockerfile. The most basic <code>docker build</code> command might look like the following:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> build</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> .</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>The final <code>.</code> in the command provides the path or URL to the <a href="https://docs.docker.com/build/concepts/context/#what-is-a-build-context" target="_blank" rel="noopener noreferrer">build context</a>. At this location, the builder will find the <code>Dockerfile</code> and other referenced files.</p><p>When you run a build, the builder pulls the base image, if needed, and then runs the instructions specified in the Dockerfile.</p><p>With the previous command, the image will <u>have no name</u>, but the output will <u>provide the ID of the image</u>. As an example, the previous command might produce the following output:</p><div class="language-console line-numbers-mode" data-highlighter="shiki" data-ext="console" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> docker build </span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">.</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">[+] Building 3.5s (11/11) FINISHED                                              docker:desktop-linux</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> =&gt; [internal] load build definition from Dockerfile                                            0.0s</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> =&gt; =&gt; transferring dockerfile: 308B                                                            0.0s</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> =&gt; [internal] load metadata for docker.io/library/python:3.12                                  0.0s</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> =&gt; [internal] load .dockerignore                                                               0.0s</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> =&gt; =&gt; transferring context: 2B                                                                 0.0s</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> =&gt; [1/6] FROM docker.io/library/python:3.12                                                    0.0s</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> =&gt; [internal] load build context                                                               0.0s</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> =&gt; =&gt; transferring context: 123B                                                               0.0s</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> =&gt; [2/6] WORKDIR /usr/local/app                                                                0.0s</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> =&gt; [3/6] RUN useradd app                                                                       0.1s</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> =&gt; [4/6] COPY ./requirements.txt ./requirements.txt                                            0.0s</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> =&gt; [5/6] RUN pip install --no-cache-dir --upgrade -r requirements.txt                          3.2s</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> =&gt; [6/6] COPY ./app ./app                                                                      0.0s</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> =&gt; exporting to image                                                                          0.1s</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> =&gt; =&gt; exporting layers                                                                         0.1s</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> =&gt; =&gt; writing image sha256:9924dfd9350407b3df01d1a0e1033b1e543523ce7d5d5e2c83a724480ebe8f00    0.0s</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>With the previous output, you could start a container by using the referenced image:</p><div class="language-console line-numbers-mode" data-highlighter="shiki" data-ext="console" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">docker run sha256:9924dfd9350407b3df01d1a0e1033b1e543523ce7d5d5e2c83a724480ebe8f00</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>That name certainly <u>isn&#39;t memorable</u>, which is where tagging becomes useful.</p><h5 id="_7-3-1-2-tagging-images" tabindex="-1"><a class="header-anchor" href="#_7-3-1-2-tagging-images"><span>7.3.1.2 Tagging images</span></a></h5><p>Tagging images is the method to provide an image with a memorable name. However, there is a <strong>structure</strong> to the name of an image. A full image name has the following structure:</p><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>[HOST[:PORT_NUMBER]/]PATH[:TAG]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><code>HOST</code>: The <mark class="tip">optional registry hostname</mark> where the image is located. If no host is specified, Docker&#39;s public registry at <strong><code>docker.io</code> is used by default</strong>.</li><li><code>PORT_NUMBER</code>: <mark class="tip">The registry port number if a hostname is provided</mark></li><li><code>PATH</code>: The path of the image, consisting of slash-separated components. <strong>For Docker Hub, the format follows <code>[NAMESPACE/]REPOSITORY</code></strong>, where namespace is either a user&#39;s or organization&#39;s name. <strong>If no namespace is specified, <code>library</code> is used,</strong> which is the namespace for Docker Official Images.</li><li><code>TAG</code>: <mark class="tip">A custom, human-readable identifier</mark> that&#39;s typically used to identify different versions or variants of an image. <strong>If no tag is specified, <code>latest</code> is used by default.</strong></li></ul><p>Some examples of image names include:</p><ul><li><code>nginx</code>, equivalent to <code>docker.io/library/nginx:latest</code>: this pulls an image from the <code>docker.io</code> registry, the <code>library</code> namespace, the <code>nginx</code> image repository, and the <code>latest</code> tag.</li><li><code>docker/welcome-to-docker</code>, equivalent to <code>docker.io/docker/welcome-to-docker:latest</code>: this pulls an image from the <code>docker.io</code> registry, the <code>docker</code> namespace, the <code>welcome-to-docker</code> image repository, and the <code>latest</code> tag</li><li><code>ghcr.io/dockersamples/example-voting-app-vote:pr-311</code>: this pulls an image from the GitHub Container Registry, the <code>dockersamples</code> namespace, the <code>example-voting-app-vote</code> image repository, and the <code>pr-311</code> tag</li></ul><p>To tag an image during a build, add the <code>-t</code> or <code>--tag</code> flag:</p><div class="language-console line-numbers-mode" data-highlighter="shiki" data-ext="console" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">docker build -t my-username/my-image .</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>If you&#39;ve already built an image, you can add another tag to the image by using the <a href="https://docs.docker.com/engine/reference/commandline/image_tag/" target="_blank" rel="noopener noreferrer"><code>docker image tag</code></a> command:</p><div class="language-console line-numbers-mode" data-highlighter="shiki" data-ext="console" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">docker image tag my-username/my-image another-username/another-image:v1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h5 id="_7-3-1-3-publishing-images" tabindex="-1"><a class="header-anchor" href="#_7-3-1-3-publishing-images"><span>7.3.1.3 Publishing images</span></a></h5><p>Once you have an image built and tagged, you&#39;re ready to push it to a registry. To do so, use the <a href="https://docs.docker.com/engine/reference/commandline/image_push/" target="_blank" rel="noopener noreferrer"><code>docker push</code></a> command:</p><div class="language-console line-numbers-mode" data-highlighter="shiki" data-ext="console" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">docker push my-username/my-image</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Within a few seconds, all of the layers for your image will be pushed to the registry.</p><h4 id="_7-3-2-docker-image-tagging-strategy" tabindex="-1"><a class="header-anchor" href="#_7-3-2-docker-image-tagging-strategy"><span>7.3.2 Docker Image Tagging Strategy</span></a></h4><p>Managing tags for Docker images according to software releases is crucial for version control and ensuring that the correct image is deployed. Here are some ways to manage tags effectively:</p>`,96)),i[43]||(i[43]=e("ol",null,[e("li",null,[e("p",null,[e("a",{href:"https://semver.org/",target:"_blank",rel:"noopener noreferrer"},[e("strong",null,"Semantic Versioning")]),s(": Use semantic versioning (SemVer) for your software releases. This approach follows a "),e("mark",{tip:""},"three-part versioning scheme: MAJOR.MINOR.PATCH."),s(" Tag your Docker images with the corresponding SemVer tag. For example, if your software release is version 1.2.3, tag the Docker image as “1.2.3”.")])]),e("li",null,[e("p",null,[e("strong",null,"Git Tags"),s(": If you use Git for version control, consider creating Git tags for each software release. These tags can be directly used as Docker image tags. For instance, if you have a Git tag “v1.2.3” for a release, use the same tag as the Docker image tag.")])]),e("li",null,[e("p",null,[e("strong",null,"Branch Names"),s(": If you follow a branching strategy for software development, you can use branch names to manage tags. For example, if you have a branch named “release/1.2.3” for a specific release, tag the corresponding Docker image as “1.2.3”.")])]),e("li",null,[e("p",null,[e("strong",null,"Date-Based Tags"),s(": Another approach is to use date-based tags for Docker images. For each software release, append the release date to the tag. For example, if the release date is June 30, 2023, tag the Docker image as “1.2.3–20230630”. This provides a clear indication of when the image was built.")])]),e("li",null,[e("p",null,[e("strong",null,"Latest Tag"),s(": Additionally, consider using a “latest” tag for the most recent stable release of your software. This allows you to easily refer to the latest version without specifying the exact version number. For instance, tag the Docker image of the latest stable release as “latest”.")])]),e("li",null,[e("p",null,[e("strong",null,"Git Commit Hash"),s(": Instead of relying solely on version numbers or dates, you can use the Git commit hash to uniquely identify a specific software release. Tag your Docker images with the corresponding commit hash, which provides a high level of traceability. For example, tag the Docker image with “1.2.3-sha1abcde”.")])])],-1)),i[44]||(i[44]=n('<p>Remember to choose a tagging strategy that aligns with your team’s workflow and requirements. Consistency and clarity in tag naming conventions are essential to avoid confusion and ensure smooth version control of Docker images.</p><h2 id="_8-running-containers" tabindex="-1"><a class="header-anchor" href="#_8-running-containers"><span>8. Running Containers</span></a></h2><h3 id="_8-1-docker-run" tabindex="-1"><a class="header-anchor" href="#_8-1-docker-run"><span>8.1 Docker Run</span></a></h3><p>The <code>docker run</code> command <u>creates and starts a new container</u> from a specified image. It combines <code>docker create</code> and <code>docker start</code> operations, offering <a href="https://docs.docker.com/engine/reference/commandline/run/" target="_blank" rel="noopener noreferrer"><u>a range of options</u></a> to customize the container&#39;s runtime environment. Users can set environment variables, map ports and volumes, define network connections, and specify resource limits. The command supports detached mode for background execution, interactive mode for shell access, and the ability to override the default command defined in the image. Common flags include <code>-d</code> for detached mode, <code>-p</code> for port mapping, <code>-v</code> for volume mounting, and <code>--name</code> for assigning a custom container name. Understanding <code>docker run</code> is fundamental to effectively deploying and managing Docker containers.</p><h3 id="_8-2-docker-compose" tabindex="-1"><a class="header-anchor" href="#_8-2-docker-compose"><span>8.2 Docker Compose</span></a></h3><p>Docker Compose is a tool for defining and running <strong>multi-container</strong> applications. It is the key to unlocking a streamlined and efficient development and deployment experience.</p><p>Compose simplifies the control of your entire application stack, making it easy to manage <mark class="info">services, networks, and volumes</mark> in a single YAML configuration file. Then, with a single command, you create and start all the services from your configuration file.</p><p>Compose works in all environments; production, staging, development, testing, as well as CI workflows. It also has commands for managing the whole lifecycle of your application:</p><ul><li>Start, stop, and rebuild services</li><li>View the status of running services</li><li>Stream the log output of running services</li><li>Run a one-off command on a service</li></ul><h4 id="_8-2-1-how-compose-works" tabindex="-1"><a class="header-anchor" href="#_8-2-1-how-compose-works"><span>8.2.1 How Compose works</span></a></h4><p>With Docker Compose you use a YAML configuration file, known as the <strong>Compose file</strong>, to configure your application’s services, and then you create and start all the services from your configuration with the <strong>Compose CLI</strong>.</p><p>The Compose file, or <code>compose.yaml</code> file, follows the rules provided by the <a href="https://docs.docker.com/reference/compose-file/" target="_blank" rel="noopener noreferrer">Compose Specification</a> in how to define multi-container applications. This is the Docker Compose implementation of the formal Compose Specification.</p><h5 id="_8-2-1-1-the-compose-file" tabindex="-1"><a class="header-anchor" href="#_8-2-1-1-the-compose-file"><span>8.2.1.1 The Compose file</span></a></h5><p>The default path for a Compose file is <code>compose.yaml</code> (preferred) or <code>compose.yml</code> that is placed in the working directory.</p><p>Compose also supports <code>docker-compose.yaml</code> and <code>docker-compose.yml</code> for backwards compatibility of earlier versions.</p><p>If both files exist, Compose prefers the canonical <code>compose.yaml</code>.</p><p>You can use <a href="https://docs.docker.com/reference/compose-file/fragments/" target="_blank" rel="noopener noreferrer">fragments</a> and <a href="https://docs.docker.com/reference/compose-file/extension/" target="_blank" rel="noopener noreferrer">extensions</a> to keep your Compose file efficient and easy to maintain.</p><p><mark class="info">Multiple</mark> Compose files can be <a href="https://docs.docker.com/reference/compose-file/merge/" target="_blank" rel="noopener noreferrer">merged</a> together to define the application model. The combination of YAML files is implemented by appending or overriding YAML elements based on the Compose file order you set. Simple attributes and maps get overridden by the <strong>highest order</strong> Compose file, lists get merged by appending. Relative paths are resolved based on the <strong>first</strong> Compose file&#39;s parent folder, whenever complimentary files being merged are hosted in other folders. As some Compose file elements can both be expressed as single strings or complex objects, merges apply to the expanded form. For more information, see <a href="https://docs.docker.com/compose/how-tos/multiple-compose-files/" target="_blank" rel="noopener noreferrer">Working with multiple Compose files</a>.</p><p>If you want to <mark class="info">reuse</mark> other Compose files, or factor out parts of your application model into separate Compose files, you can also use <a href="https://docs.docker.com/reference/compose-file/include/" target="_blank" rel="noopener noreferrer"><code>include</code></a>. This is useful if your Compose application is dependent on another application which is managed by a different team, or needs to be shared with others.</p><h5 id="_8-2-1-2-cli" tabindex="-1"><a class="header-anchor" href="#_8-2-1-2-cli"><span>8.2.1.2 CLI</span></a></h5><p>The Docker CLI lets you interact with your Docker Compose applications through the <code>docker compose</code> command, and its subcommands. Using the CLI, you can manage the lifecycle of your multi-container applications defined in the <code>compose.yaml</code> file. The CLI commands enable you to start, stop, and configure your applications effortlessly.</p><p>To <strong>start</strong> all the services defined in your <code>compose.yaml</code> file:</p><div class="language-console line-numbers-mode" data-highlighter="shiki" data-ext="console" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> docker compose up</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>To <strong>stop and remove</strong> the running services:</p><div class="language-console line-numbers-mode" data-highlighter="shiki" data-ext="console" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> docker compose down</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>If you want to <strong>monitor the output</strong> of your running containers and debug issues, you can view the logs with:</p><div class="language-console line-numbers-mode" data-highlighter="shiki" data-ext="console" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> docker compose logs</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>To <strong>list all the services</strong> along with their current status:</p><div class="language-console line-numbers-mode" data-highlighter="shiki" data-ext="console" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> docker compose ps</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>For a full list of all the Compose CLI commands, see the <a href="https://docs.docker.com/reference/cli/docker/compose/" target="_blank" rel="noopener noreferrer">reference documentation</a>.</p><h5 id="_8-2-1-3-illustrative-example" tabindex="-1"><a class="header-anchor" href="#_8-2-1-3-illustrative-example"><span>8.2.1.3 Illustrative example</span></a></h5><p>The following example illustrates the Compose concepts outlined above. The example is <em>non-normative</em>.</p><p>Consider an application split into a <em>frontend web application</em> and a <em>backend service</em>.</p><p>The frontend is configured at runtime with an HTTP configuration file managed by infrastructure, providing an external domain name, and an HTTPS server certificate injected by the platform&#39;s secured secret store.</p><p>The backend stores data in a persistent volume.</p><p>Both services communicate with each other on an isolated back-tier network, while the frontend is also connected to a front-tier network and exposes port 443 for external usage.</p><figure><img src="'+f+`" alt="Compose application example" tabindex="0" loading="lazy"><figcaption>Compose application example</figcaption></figure><p>The example application is composed of the following parts:</p><ul><li>2 services, backed by Docker images: <code>webapp</code> and <code>database</code></li><li>1 secret (HTTPS certificate), injected into the frontend</li><li>1 configuration (HTTP), injected into the frontend</li><li>1 persistent volume, attached to the backend</li><li>2 networks</li></ul><div class="language-yml line-numbers-mode" data-highlighter="shiki" data-ext="yml" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">services</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  frontend</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    image</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> example/webapp</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    ports</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      -</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">443:8043</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    networks</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> front-tier</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> back-tier</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    configs</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> httpd-config</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    secrets</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> server-certificate</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  backend</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    image</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> example/database</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    volumes</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> db-data:/etc/data</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    networks</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> back-tier</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">volumes</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  db-data</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    driver</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> flocker</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    driver_opts</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">      size</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">10GiB</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">configs</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  httpd-config</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    external</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> true</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">secrets</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  server-certificate</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    external</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> true</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">networks</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # The presence of these objects is sufficient to define them</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  front-tier</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {}</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  back-tier</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The <code>docker compose up</code> command starts the <code>frontend</code> and <code>backend</code> services, creates the necessary networks and volumes, and injects the configuration and secret into the frontend service.</p><p><code>docker compose ps</code> provides a snapshot of the current state of your services, making it easy to see which containers are running, their status, and the ports they are using:</p><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>$ docker compose ps</span></span>
<span class="line"><span></span></span>
<span class="line"><span>NAME                IMAGE                COMMAND                  SERVICE             CREATED             STATUS              PORTS</span></span>
<span class="line"><span>example-frontend-1  example/webapp       &quot;nginx -g &#39;daemon of…&quot;   frontend            2 minutes ago       Up 2 minutes        0.0.0.0:443-&gt;8043/tcp</span></span>
<span class="line"><span>example-backend-1   example/database     &quot;docker-entrypoint.s…&quot;   backend             2 minutes ago       Up 2 minutes</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-2-2-other-references" tabindex="-1"><a class="header-anchor" href="#_8-2-2-other-references"><span>8.2.2 Other references</span></a></h4><p>Refer to <a href="https://docs.docker.com/compose/" target="_blank" rel="noopener noreferrer">here</a> to get more infomation about:</p><ul><li>Why use Compose?</li><li>Install Compose</li><li>View the release notes</li><li>Explore the <a href="https://docs.docker.com/reference/compose-file/" target="_blank" rel="noopener noreferrer">Compose file reference</a>: with this reference, you can find information on defining: <ul><li>version</li><li>services</li><li>networks</li><li>volumes</li><li>configs</li><li>secrets</li></ul></li></ul><h4 id="_8-2-3-curated-docker-compose-samples" tabindex="-1"><a class="header-anchor" href="#_8-2-3-curated-docker-compose-samples"><span>8.2.3 Curated Docker Compose Samples</span></a></h4><p><a href="https://github.com/docker/awesome-compose?tab=readme-ov-file" target="_blank" rel="noopener noreferrer">These</a> samples provide a starting point for how to integrate different services using a Compose file and to manage their deployment with Docker Compose. Useful in local development environments such as project setups, tinkering with software stacks, etc. These samples must <strong>not</strong> be deployed in production environments.</p><h2 id="_9-container-security" tabindex="-1"><a class="header-anchor" href="#_9-container-security"><span>9. Container Security</span></a></h2><h3 id="_9-1-runtime-security" tabindex="-1"><a class="header-anchor" href="#_9-1-runtime-security"><span>9.1 Runtime Security</span></a></h3><p>Runtime security in Docker focuses on <mark class="tip">ensuring the safety and integrity of containers during their execution</mark>, safeguarding against vulnerabilities and malicious activities that could arise while the containerized application is running. This involves monitoring container behavior for anomalies, implementing access controls to limit permissions, and employing tools to detect and respond to suspicious activity in real time. Effective runtime security also ensures that only verified images are deployed and continuously audits the system to maintain compliance, thereby providing a robust defense layer to prevent exploits and maintain the desired security posture throughout the container lifecycle.</p><p>There are four major areas to consider when reviewing Docker security:</p><ul><li>The <u>intrinsic security</u> of the kernel and its support for <strong>namespaces</strong> and <strong>cgroups</strong></li><li>The attack surface of the <strong>Docker daemon</strong> itself</li><li>Loopholes in the <strong>container configuration profile</strong>, either by default, or when customized by users.</li><li>The &quot;hardening&quot; security features of the <strong>kernel</strong> and how they interact with containers.</li></ul><h4 id="_9-1-1-kernel-namespaces" tabindex="-1"><a class="header-anchor" href="#_9-1-1-kernel-namespaces"><span>9.1.1 Kernel namespaces</span></a></h4><p>When you start a container with <code>docker run</code>, behind the scenes <u>Docker creates a set of namespaces and control groups for the container</u>.</p><p>Namespaces provide the <mark class="tip">first and most straightforward form of <strong>isolation</strong></mark>. Processes running within a container cannot see, and even less affect, processes running in another container, or in the host system.</p><p>Each container also <mark class="tip">gets its own network stack</mark>, meaning that a container doesn&#39;t get privileged access to the sockets or interfaces of another container. Of course, if the host system is setup accordingly, containers can interact with each other through their respective network interfaces — just like they can interact with external hosts. When you specify public ports for your containers or use links then IP traffic is allowed between containers. They can ping each other, send/receive UDP packets, and establish TCP connections, but that can be restricted if necessary. From a network architecture point of view, all containers on a given Docker host are sitting on bridge interfaces. This means that they are just like physical machines connected through a common Ethernet switch; no more, no less.</p><p>How mature is the code providing kernel namespaces and private networking? Kernel namespaces were introduced between kernel version 2.6.15 and 2.6.26. This means that since July 2008 (date of the 2.6.26 release), namespace code has been exercised and scrutinized on a large number of production systems.</p><h4 id="_9-1-2-control-groups" tabindex="-1"><a class="header-anchor" href="#_9-1-2-control-groups"><span>9.1.2 Control groups</span></a></h4><p>Control Groups are another key component of Linux containers. They implement <strong>resource accounting and limiting</strong>. <mark class="tip">They provide many useful metrics, but they also help ensure that each container gets its fair share of memory, CPU, disk I/O; and, more importantly, that a single container cannot bring the system down by exhausting one of those resources.</mark></p><p>So while they do not play a role in preventing one container from accessing or affecting the data and processes of another container, they are essential to fend off some denial-of-service attacks. They are particularly important on multi-tenant platforms, like public and private PaaS, to guarantee a consistent uptime (and performance) even when some applications start to misbehave.</p><p>Control Groups have been around for a while as well: the code was started in 2006, and initially merged in kernel 2.6.24.</p><h4 id="_9-1-3-docker-daemon-attack-surface" tabindex="-1"><a class="header-anchor" href="#_9-1-3-docker-daemon-attack-surface"><span>9.1.3 Docker daemon attack surface</span></a></h4><p>Running containers (and applications) with Docker implies running the Docker daemon. <u>This daemon requires <code>root</code> privileges unless you opt-in to Rootless mode</u>, and you should therefore be aware of some important details.</p><p>First of all, only <strong>trusted users</strong> should be allowed to control your Docker daemon. This is a direct consequence of some powerful Docker features. Specifically, Docker allows you to share a directory between the Docker host and a guest container; and it allows you to do so without limiting the access rights of the container. This means that you can start a container where the <code>/host</code> directory is the <code>/</code> directory on your host; and the container can alter your host filesystem without any restriction. This is similar to how virtualization systems allow filesystem resource sharing. Nothing prevents you from sharing your root filesystem (or even your root block device) with a virtual machine.</p><p>This has a strong security implication: for example, if you instrument Docker from a web server to provision containers through an API, you should be even more careful than usual with parameter checking, to make sure that a malicious user cannot pass crafted parameters causing Docker to create arbitrary containers.</p><p>For this reason, the REST API endpoint (used by the Docker CLI to communicate with the Docker daemon) changed in Docker 0.5.2, and now uses a Unix socket instead of a TCP socket bound on 127.0.0.1 (the latter being prone to cross-site request forgery attacks if you happen to run Docker directly on your local machine, outside of a VM). You can then use traditional Unix permission checks to limit access to the control socket.</p><p>The daemon is also potentially <strong>vulnerable to other inputs</strong>, such as image loading from either disk with <code>docker load</code>, or from the network with <code>docker pull</code>. As of Docker 1.3.2, images are now extracted in a chrooted subprocess on Linux/Unix platforms, being the first-step in a wider effort toward privilege separation. As of Docker 1.10.0, all images are stored and accessed by the cryptographic checksums of their contents, limiting the possibility of an attacker causing a collision with an existing image.</p><p>Finally, if you run Docker on a server, it is recommended to run exclusively Docker on the server, and move all other services within containers controlled by Docker. Of course, it is fine to keep your favorite admin tools (probably at least an SSH server), as well as existing monitoring/supervision processes, such as NRPE and collectd.</p><h4 id="_9-1-4-linux-kernel-capabilities" tabindex="-1"><a class="header-anchor" href="#_9-1-4-linux-kernel-capabilities"><span>9.1.4 Linux kernel capabilities</span></a></h4><p>By default, Docker starts containers with <strong>a restricted set of capabilities</strong>. What does that mean?</p><p>Capabilities turn the binary &quot;root/non-root&quot; dichotomy into a fine-grained access control system. Processes (like web servers) that <u>just need to bind on a port below 1024 do not need to run as root: they can just be granted the <code>net_bind_service</code> capability instead</u>. And there are many other capabilities, for almost all the specific areas where root privileges are usually needed. This means a lot for container security.</p><p>Typical servers run several processes as <code>root</code>, including the SSH daemon, <code>cron</code> daemon, logging daemons, kernel modules, network configuration tools, and more. <u>A container is different, because almost all of those tasks are handled by the infrastructure around the container</u>:</p><ul><li><strong>SSH access</strong> are typically managed by a single server running on the Docker host</li><li><code>cron</code>, when necessary, should run as a <u>user process</u>, dedicated and tailored for the app that needs its scheduling service, rather than as a platform-wide facility</li><li><strong>Log management</strong> is also typically handed to Docker, or to third-party services like Loggly or Splunk</li><li><strong>Hardware management</strong> is irrelevant, meaning that you never need to run <code>udevd</code> or equivalent daemons within containers</li><li><strong>Network management</strong> happens outside of the containers, enforcing separation of concerns as much as possible, meaning that a container should never need to perform <code>ifconfig</code>, <code>route</code>, or ip commands (except when a container is specifically engineered to behave like a router or firewall, of course)</li></ul><p>This means that <mark class="tip">in most cases, containers do not need &quot;real&quot; root privileges at all*</mark> And therefore, containers can run with a reduced capability set; meaning that <mark class="tip">&quot;root&quot; within a container has much less privileges than the real &quot;root&quot;</mark>. For instance, it is possible to:</p><ul><li>Deny all &quot;mount&quot; operations</li><li>Deny access to raw sockets (to prevent packet spoofing)</li><li>Deny access to some filesystem operations, like creating new device nodes, changing the owner of files, or altering attributes (including the immutable flag)</li><li>Deny module loading</li></ul><p>This means that <mark class="tip">even if an intruder manages to escalate to root within a container, it is much harder to do serious damage, or to escalate to the host.</mark></p><p>This doesn&#39;t affect regular web apps, but reduces the vectors of attack by malicious users considerably. By default Docker drops all capabilities except those needed, <u>an allowlist instead of a denylist approach</u>. You can see a full list of available capabilities in Linux manpages.</p><p>One primary <strong>risk</strong> with running Docker containers is that the default set of capabilities and mounts given to a container may provide <strong>incomplete isolation</strong>, either independently, or when used in combination with kernel vulnerabilities.</p><p>Docker supports the addition and removal of capabilities, allowing use of a non-default profile. This may make Docker more secure through capability removal, or less secure through the addition of capabilities. The best practice for users would be to <mark class="tip">remove all capabilities except those explicitly required for their processes</mark>.</p><h4 id="_9-1-5-docker-content-trust-signature-verification" tabindex="-1"><a class="header-anchor" href="#_9-1-5-docker-content-trust-signature-verification"><span>9.1.5 Docker Content Trust signature verification</span></a></h4><p>Docker Engine can be configured to <strong>only run signed images</strong>. The Docker Content Trust signature verification feature is built directly into the <code>dockerd</code> binary. This is configured in the Dockerd configuration file.</p><p>To enable this feature, trustpinning can be configured in <code>daemon.json</code>, whereby only repositories signed with a user-specified root key can be pulled and run.</p><p>This feature provides more insight to administrators than previously available with the CLI for enforcing and performing image signature verification.</p><h4 id="_9-1-6-other-kernel-security-features" tabindex="-1"><a class="header-anchor" href="#_9-1-6-other-kernel-security-features"><span>9.1.6 Other kernel security features</span></a></h4><p>Capabilities are just one of the many security features provided by modern Linux kernels. It is also possible to <mark class="tip">leverage existing, well-known systems like TOMOYO, AppArmor, SELinux, GRSEC, etc. with Docker</mark>.</p><p>While Docker currently only enables capabilities, <u>it doesn&#39;t interfere with the other systems</u>. This means that there are many different ways to harden a Docker host. Here are a few examples.</p><ul><li>You can run a kernel with GRSEC and PAX. This adds many safety checks, both at compile-time and run-time; it also defeats many exploits, thanks to techniques like address randomization. It doesn&#39;t require Docker-specific configuration, since those security features apply system-wide, independent of containers.</li><li>If your distribution comes with security model templates for Docker containers, you can use them out of the box. For instance, we ship a template that works with AppArmor and Red Hat comes with SELinux policies for Docker. These templates provide an extra safety net (even though it overlaps greatly with capabilities).</li><li>You can define your own policies using your favorite access control mechanism.</li></ul><p>Just as you can use third-party tools to augment Docker containers, including special network topologies or shared filesystems, tools exist to harden Docker containers without the need to modify Docker itself.</p><h4 id="_9-1-7-conclusions" tabindex="-1"><a class="header-anchor" href="#_9-1-7-conclusions"><span>9.1.7 Conclusions</span></a></h4><p>Docker containers are, by default, quite secure; especially if you run your processes as non-privileged users inside the container.</p><p>You can add an extra layer of safety by enabling AppArmor, SELinux, GRSEC, or another appropriate hardening system.</p><h3 id="_9-2-image-security-————-content-trust-in-docker" tabindex="-1"><a class="header-anchor" href="#_9-2-image-security-————-content-trust-in-docker"><span>9.2 Image Security ———— Content trust in Docker</span></a></h3><p>Image security is a crucial aspect of deploying Docker containers in your environment. <mark class="tip">Ensuring the images you use are secure, up to date, and free of vulnerabilities</mark> is essential. In this section, we will review best practices and tools for securing and managing your Docker images. When pulling images from public repositories, always use trusted, official images as a starting point for your containerized applications. Official images are vetted by Docker and are regularly updated with security fixes. You can find these images on the Docker Hub or other trusted registries.</p><p>When transferring data among networked systems, trust is a central concern. In particular, when communicating over an untrusted medium such as the internet, it is critical to ensure the integrity and the publisher of all the data a system operates on. You use Docker Engine to push and pull images (data) to a public or private registry. <mark class="tip">Content trust gives you the ability to verify both the integrity and the publisher of all the data received from a registry over any channel</mark>.</p><h4 id="_9-2-1-about-docker-content-trust-dct" tabindex="-1"><a class="header-anchor" href="#_9-2-1-about-docker-content-trust-dct"><span>9.2.1 About Docker Content Trust (DCT)</span></a></h4><p>Docker Content Trust (DCT) provides the ability to <mark class="tip">use digital signatures for data sent to and received from remote Docker registries</mark>. These signatures allow client-side or runtime verification of the integrity and publisher of specific image tags.</p><p>Through DCT, image publishers can sign their images, and image consumers can ensure that the images they pull are signed. Publishers could be individuals or organizations manually signing their content, or automated software supply chains signing content as part of their release process.</p><h4 id="_9-2-2-image-tags-and-dct" tabindex="-1"><a class="header-anchor" href="#_9-2-2-image-tags-and-dct"><span>9.2.2 Image tags and DCT</span></a></h4><p>An individual image record has the following identifier:</p><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>[REGISTRY_HOST[:REGISTRY_PORT]/]REPOSITORY[:TAG]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>A particular image <code>REPOSITORY</code> can have multiple tags. For example, <code>latest</code> and <code>3.1.2</code> are both tags on the <code>mongo</code> image. An image publisher can build an image and tag combination many times changing the image with each build.</p><p><strong>DCT is associated with the <code>TAG</code> portion of an image</strong>. Each image repository has a set of keys that image publishers use to sign an image tag. Image publishers have discretion on which tags they sign.</p><p>An image repository can contain an image with one tag that is signed and another tag that is not. For example, consider the Mongo image repository. The <code>latest</code> tag could be unsigned while the <code>3.1.6</code> tag could be signed. <u>It is the responsibility of the image publisher to decide if an image tag is signed or not</u>.</p><p>Publishers can choose to sign a specific tag or not. As a result, <u>the content of an unsigned tag and that of a signed tag with the same name may not match</u>. For example, a publisher can push a tagged image <code>someimage:latest</code> and sign it. Later, the same publisher can push an unsigned <code>someimage:latest</code> image. <u>This second push replaces the last unsigned tag <code>latest</code> but does not affect the signed <code>latest</code> version.</u> The ability to choose which tags they can sign, allows publishers to iterate over the unsigned version of an image before officially signing it.</p><p><mark class="info">Image consumers can enable DCT to ensure that images they use were signed</mark>. If a consumer <strong>enables</strong> DCT, they can only pull, run, or build with <strong>trusted</strong> images. Enabling DCT is a bit like applying a &quot;filter&quot; to your registry. Consumers &quot;see&quot; only signed image tags and the less desirable, unsigned image tags are &quot;invisible&quot; to them.</p><p>To the consumer who has <strong>not enabled</strong> DCT, nothing about how they work with Docker images changes. Every image is visible regardless of whether it is signed or not.</p><h4 id="_9-2-3-docker-content-trust-keys" tabindex="-1"><a class="header-anchor" href="#_9-2-3-docker-content-trust-keys"><span>9.2.3 Docker Content Trust Keys</span></a></h4><p><mark class="info">Trust for an image tag is managed through the use of signing <strong>keys</strong></mark>. A key set is created when an operation using DCT is first invoked. A key set consists of the following classes of keys:</p><ul><li>An offline key that is the root of DCT for an image tag</li><li>Repository or tagging keys that sign tags</li><li>Server-managed keys such as the timestamp key, which provides freshness security guarantees for your repository</li></ul><div class="hint-container warning"><p class="hint-container-title">Warning</p><p>The root key once lost is not recoverable. If you lose any other key, send an email to Docker Hub Support. This loss also requires manual intervention from every consumer that used a signed tag from this repository prior to the loss.</p></div><p>You should back up the root key somewhere safe. Given that it is only required to create new repositories, it is a good idea to store it offline in hardware.</p><h4 id="_9-2-4-signing-images-with-docker-content-trust" tabindex="-1"><a class="header-anchor" href="#_9-2-4-signing-images-with-docker-content-trust"><span>9.2.4 Signing images with Docker Content Trust</span></a></h4><p>Within the Docker CLI we can sign and push a container image with the <code>$ docker trust</code> command syntax. This is built on top of the Notary feature set. For more information, see the Notary GitHub repository.</p><p>A prerequisite for signing an image is a Docker Registry with a Notary server attached (Such as the Docker Hub ). Instructions for standing up a self-hosted environment can be found here.</p><p>To sign a Docker Image you will need <strong>a delegation key pair</strong>. These keys can be generated locally using <code>$ docker trust key generate</code> or generated by a certificate authority.</p><p>First we will add the delegation private key to the local Docker trust repository. (By default this is stored in <code>~/.docker/trust/</code>). If you are generating delegation keys with <code>$ docker trust key generate</code>, the private key is automatically added to the local trust store. If you are importing a separate key, you will need to use the <code>$ docker trust key load</code> command.</p><div class="language-console line-numbers-mode" data-highlighter="shiki" data-ext="console" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> docker trust key generate jeff</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Generating key for jeff...</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Enter passphrase for new jeff key with ID 9deed25:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Repeat passphrase for new jeff key with ID 9deed25:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Successfully generated and loaded private key. Corresponding public key available: /home/ubuntu/Documents/mytrustdir/jeff.pub</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Or if you have an existing key:</p><div class="language-console line-numbers-mode" data-highlighter="shiki" data-ext="console" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> docker trust key load key.pem --name jeff</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Loading key from &quot;key.pem&quot;...</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Enter passphrase for new jeff key with ID 8ae710e:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Repeat passphrase for new jeff key with ID 8ae710e:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Successfully imported key from key.pem</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Next we will need to add the delegation public key to the Notary server; this is specific to a particular image repository in Notary known as a Global Unique Name (GUN). If this is the first time you are adding a delegation to that repository, this command will also initiate the repository, using a local Notary canonical root key. To understand more about initiating a repository, and the role of delegations, head to delegations for content trust.</p><div class="language-console line-numbers-mode" data-highlighter="shiki" data-ext="console" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> docker trust signer add --key cert.pem jeff registry.example.com/admin/demo</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Adding signer &quot;jeff&quot; to registry.example.com/admin/demo...</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Enter passphrase for new repository key with ID 10b5e94:</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Finally, we will use the delegation private key to sign a particular tag and push it up to the registry.</p><div class="language-console line-numbers-mode" data-highlighter="shiki" data-ext="console" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> docker trust sign registry.example.com/admin/demo:1</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Signing and pushing trust data for local image registry.example.com/admin/demo:1, may overwrite remote trust data</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">The push refers to repository [registry.example.com/admin/demo]</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7bff100f35cb: Pushed</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1: digest: sha256:3d2e482b82608d153a374df3357c0291589a61cc194ec4a9ca2381073a17f58e size: 528</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Signing and pushing trust metadata</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Enter passphrase for signer key with ID 8ae710e:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Successfully signed registry.example.com/admin/demo:1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Alternatively, once the keys have been imported an image can be pushed with the <code>$ docker push</code> command, by exporting the DCT environmental variable.</p><div class="language-console line-numbers-mode" data-highlighter="shiki" data-ext="console" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> export</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> DOCKER_CONTENT_TRUST</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> docker push registry.example.com/admin/demo:1</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">The push refers to repository [registry.example.com/admin/demo:1]</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7bff100f35cb: Pushed</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1: digest: sha256:3d2e482b82608d153a374df3357c0291589a61cc194ec4a9ca2381073a17f58e size: 528</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Signing and pushing trust metadata</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Enter passphrase for signer key with ID 8ae710e:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Successfully signed registry.example.com/admin/demo:1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Remote trust data for a tag or a repository can be viewed by the <code>$ docker trust inspect</code> command:</p><div class="language-console line-numbers-mode" data-highlighter="shiki" data-ext="console" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> docker trust inspect --pretty registry.example.com/admin/demo:1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Signatures for registry.example.com/admin/demo:1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SIGNED TAG          DIGEST                                                             SIGNERS</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1                   3d2e482b82608d153a374df3357c0291589a61cc194ec4a9ca2381073a17f58e   jeff</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">List of signers and their keys for registry.example.com/admin/demo:1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SIGNER              KEYS</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">jeff                8ae710e3ba82</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Administrative keys for registry.example.com/admin/demo:1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  Repository Key:	10b5e94c916a0977471cc08fa56c1a5679819b2005ba6a257aa78ce76d3a1e27</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  Root Key:	84ca6e4416416d78c4597e754f38517bea95ab427e5f95871f90d460573071fc</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Remote Trust data for a tag can be removed by the <code>$ docker trust revoke</code> command:</p><div class="language-console line-numbers-mode" data-highlighter="shiki" data-ext="console" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> docker trust revoke registry.example.com/admin/demo:1</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Enter passphrase for signer key with ID 8ae710e:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Successfully deleted signature for registry.example.com/admin/demo:1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_9-2-5-client-enforcement-with-docker-content-trust" tabindex="-1"><a class="header-anchor" href="#_9-2-5-client-enforcement-with-docker-content-trust"><span>9.2.5 Client enforcement with Docker Content Trust</span></a></h4><p>Content trust is disabled by default in the Docker Client. <u>To enable it, set the <code>DOCKER_CONTENT_TRUST</code> environment variable to <code>1</code>.</u> This prevents users from working with tagged images unless they contain a signature.</p><p>When DCT is enabled in the Docker client, <code>docker</code> CLI commands that operate on tagged images must either have content signatures or explicit content hashes. The commands that operate with DCT are:</p><ul><li><code>push</code></li><li><code>build</code></li><li><code>create</code></li><li><code>pull</code></li><li><code>run</code></li></ul><p>For example, with DCT enabled a <code>docker pull someimage:latest</code> only succeeds if <code>someimage:latest</code> <strong>is signed</strong>. However, an operation with an explicit content hash always succeeds as long as the hash exists:</p><div class="language-console line-numbers-mode" data-highlighter="shiki" data-ext="console" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> docker pull registry.example.com/user/image:1</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Error: remote trust data does not exist for registry.example.com/user/image: registry.example.com does not have trust data for registry.example.com/user/image</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> docker pull registry.example.com/user/image@sha256:d149ab53f8718e987c3a3024bb8aa0e2caadf6c0328f1d9d850b2a2a67f2819a</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">sha256:ee7491c9c31db1ffb7673d91e9fac5d6354a89d0e97408567e09df069a1687c1: Pulling from user/image</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ff3a5c916c92: Pull complete</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">a59a168caba3: Pull complete</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Digest: sha256:ee7491c9c31db1ffb7673d91e9fac5d6354a89d0e97408567e09df069a1687c1</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Status: Downloaded newer image for registry.example.com/user/image@sha256:ee7491c9c31db1ffb7673d91e9fac5d6354a89d0e97408567e09df069a1687c1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_10-docker-cli" tabindex="-1"><a class="header-anchor" href="#_10-docker-cli"><span>10. Docker CLI</span></a></h2><h3 id="_10-1-containers" tabindex="-1"><a class="header-anchor" href="#_10-1-containers"><span>10.1 Containers</span></a></h3><p>Refer to <a href="https://docs.docker.com/reference/cli/docker/" target="_blank" rel="noopener noreferrer">here</a> to view base commands for docker.</p><h3 id="_10-2-images" tabindex="-1"><a class="header-anchor" href="#_10-2-images"><span>10.2 Images</span></a></h3><p>Refer to <a href="https://docs.docker.com/reference/cli/docker/image/" target="_blank" rel="noopener noreferrer">here</a> to learn how to manage images.</p><h3 id="_10-3-volumes" tabindex="-1"><a class="header-anchor" href="#_10-3-volumes"><span>10.3 Volumes</span></a></h3><ul><li><a href="https://docs.docker.com/engine/storage/volumes/" target="_blank" rel="noopener noreferrer">Introduction of Volume</a></li><li><a href="https://docs.docker.com/reference/cli/docker/volume/" target="_blank" rel="noopener noreferrer">Related commands of Volume</a></li></ul><h3 id="_10-4-networks" tabindex="-1"><a class="header-anchor" href="#_10-4-networks"><span>10.4 Networks</span></a></h3><h4 id="_10-4-1-networking-overview" tabindex="-1"><a class="header-anchor" href="#_10-4-1-networking-overview"><span>10.4.1 Networking overview</span></a></h4><p>Container networking refers to <mark class="info">the ability for containers to connect to and communicate with each other, or to non-Docker workloads.</mark></p><p>Containers have networking enabled by default, and they can make outgoing connections. <u>A container has no information about what kind of network it&#39;s attached to, or whether their peers are also Docker workloads or not.</u> A container only sees a network interface with an IP address, a gateway, a routing table, DNS services, and other networking details. That is, unless the container uses the <code>none</code> network driver.</p><p>This section describes networking from the point of view of the container, and the concepts around container networking. It doesn&#39;t describe OS-specific details about how Docker networks work. For information about how Docker manipulates <code>iptables</code> rules on Linux, see <a href="https://docs.docker.com/engine/network/packet-filtering-firewalls/" target="_blank" rel="noopener noreferrer">Packet filtering and firewalls</a>.</p><h5 id="_10-4-1-1-user-defined-networks" tabindex="-1"><a class="header-anchor" href="#_10-4-1-1-user-defined-networks"><span>10.4.1.1 User-defined networks</span></a></h5><p>You can create custom, user-defined networks, and connect multiple containers to the same network. Once connected to a user-defined network, containers can communicate with each other <u>using container IP addresses or container names</u>.</p><p>The following example creates a network using the <code>bridge</code> network driver and running a container in the created network:</p><div class="language-console line-numbers-mode" data-highlighter="shiki" data-ext="console" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> docker network create -d bridge my-net</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> docker run </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">--network</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">my-net</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> -itd</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --name=container3</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> busybox</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_10-4-1-2-drivers" tabindex="-1"><a class="header-anchor" href="#_10-4-1-2-drivers"><span>10.4.1.2 Drivers</span></a></h5><p>The following network drivers are available by default, and provide core networking functionality:</p><table><thead><tr><th style="text-align:left;">Driver</th><th style="text-align:left;">Description</th></tr></thead><tbody><tr><td style="text-align:left;"><code>bridge</code></td><td style="text-align:left;">The <strong>default</strong> network driver.</td></tr><tr><td style="text-align:left;"><code>host</code></td><td style="text-align:left;"><strong>Remove network isolation</strong> between the container and the Docker host.</td></tr><tr><td style="text-align:left;"><code>none</code></td><td style="text-align:left;"><strong>Completely isolate</strong> a container from the host and other containers.</td></tr><tr><td style="text-align:left;"><code>overlay</code></td><td style="text-align:left;">Overlay networks connect <strong>multiple Docker daemons</strong> together.</td></tr><tr><td style="text-align:left;"><code>ipvlan</code></td><td style="text-align:left;">IPvlan networks provide full control over <strong>both IPv4 and IPv6 addressing</strong>.</td></tr><tr><td style="text-align:left;"><code>macvlan</code></td><td style="text-align:left;">Assign a <strong>MAC</strong> address to a container.</td></tr></tbody></table><p>For more information about the different drivers, see <a href="https://docs.docker.com/engine/network/drivers/" target="_blank" rel="noopener noreferrer">Network drivers overview</a>.</p><h5 id="_10-4-1-3-connecting-to-multiple-networks" tabindex="-1"><a class="header-anchor" href="#_10-4-1-3-connecting-to-multiple-networks"><span>10.4.1.3 Connecting to multiple networks</span></a></h5><p><strong>A container can be connected to multiple networks.</strong> For example, a frontend container may be connected to <u>a bridge network with external access</u>, and <u>a <a href="https://docs.docker.com/reference/cli/docker/network/create/#internal" target="_blank" rel="noopener noreferrer"><code>--internal</code></a> network to communicate with containers running backend services that do not need external network access</u>.</p><p><strong>A container may also be connected to different types of network</strong>. For example, an <code>ipvlan</code> network to provide internet access, and a <code>bridge</code> network for access to local services.</p><p>When sending packets, <u>if the destination is an address in a directly connected network, packets are sent to that <strong>network</strong>. Otherwise, packets are sent to a default <strong>gateway</strong> for routing to their destination.</u> In the example above, the <code>ipvlan</code> network&#39;s gateway must be the default gateway.</p><p>The default gateway is selected by Docker, and may change whenever a container&#39;s network connections change. To make Docker choose a specific default gateway when creating the container or connecting a new network, set a gateway priority. See option <code>gw-priority</code> for the <code>docker run</code> and <code>docker network connect</code> commands.</p><p>The default <code>gw-priority</code> is <code>0</code> and the gateway in the network with the highest priority is the default gateway. So, when a network should always be the default gateway, it is enough to set its <code>gw-priority</code> to <code>1</code>.</p><div class="language-console line-numbers-mode" data-highlighter="shiki" data-ext="console" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> docker run --network </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">gwnet,</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">gw-priority</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">1</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> --network</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> anet1</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --name</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> myctr</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> myimage</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> docker network connect anet2 myctr</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_10-4-1-4-container-networks" tabindex="-1"><a class="header-anchor" href="#_10-4-1-4-container-networks"><span>10.4.1.4 Container networks</span></a></h5><p>In addition to user-defined networks, <strong>you can attach a container to another container&#39;s networking stack directly</strong>, using the <code>--network container:&lt;name|id&gt;</code> flag format.</p><p>The following flags aren&#39;t supported for containers using the <code>container:</code> networking mode:</p><ul><li><code>--add-host</code></li><li><code>--hostname</code></li><li><code>--dns</code></li><li><code>--dns-search</code></li><li><code>--dns-option</code></li><li><code>--mac-address</code></li><li><code>--publish</code></li><li><code>--publish-all</code></li><li><code>--expose</code></li></ul><p>The following example runs a Redis container, with Redis binding to <code>localhost</code>, then running the <code>redis-cli</code> command and connecting to the Redis server over the <code>localhost</code> interface.</p><div class="language-console line-numbers-mode" data-highlighter="shiki" data-ext="console" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> docker run -d --name redis example/redis --bind 127.0.0.1</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> docker run --rm -it --network container:redis example/redis-cli -h 127.0.0.1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_10-4-1-5-published-ports" tabindex="-1"><a class="header-anchor" href="#_10-4-1-5-published-ports"><span>10.4.1.5 Published ports</span></a></h5><p>By default, when you create or run a container using <code>docker create</code> or <code>docker run</code>, containers on bridge networks <u>don&#39;t expose any ports to the outside world</u>. Use the <code>--publish</code> or <code>-p</code> flag to make a port available to services outside the bridge network. This creates a firewall rule in the host, mapping a container port to a port on the Docker host to the outside world. Here are some examples:</p><table><thead><tr><th>Flag value</th><th>Description</th></tr></thead><tbody><tr><td><code>-p 8080:80</code></td><td>Map port <code>8080</code> on the Docker host to TCP port <code>80</code> in the container.</td></tr><tr><td><code>-p 192.168.1.100:8080:80</code></td><td>Map port <code>8080</code> on the Docker host IP <code>192.168.1.100</code> to TCP port <code>80</code> in the container.</td></tr><tr><td><code>-p 8080:80/udp</code></td><td>Map port <code>8080</code> on the Docker host to UDP port <code>80</code> in the container.</td></tr><tr><td><code>-p 8080:80/tcp -p 8080:80/udp</code></td><td>Map TCP port <code>8080</code> on the Docker host to TCP port <code>80</code> in the container, and map UDP port <code>8080</code> on the Docker host to UDP port <code>80</code> in the container.</td></tr></tbody></table><div class="hint-container important"><p class="hint-container-title">Important</p><p>Publishing container ports is insecure by default. Meaning, when you publish a container&#39;s ports it becomes available not only to the Docker host, but to the outside world as well.</p><p>If you include the localhost IP address (<code>127.0.0.1</code>, or <code>::1</code>) with the publish flag, only the Docker host and its containers can access the published container port.</p><div class="language-console line-numbers-mode" data-highlighter="shiki" data-ext="console" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> docker run -p 127.0.0.1:8080:80 -p </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">[::1]:8080:80</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> nginx</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="hint-container warning"><p class="hint-container-title">Warning</p><p>In releases older than 28.0.0, hosts within the same L2 segment (for example, hosts connected to the same network switch) can reach ports published to localhost. For more information, see <a href="https://github.com/moby/moby/issues/45610" target="_blank" rel="noopener noreferrer">moby/moby#45610</a></p></div></div><p><mark class="info">If you want to make a container accessible to other containers, it isn&#39;t necessary to publish the container&#39;s ports.</mark> You can enable inter-container communication by connecting the containers to the same network, usually a <a href="https://docs.docker.com/engine/network/drivers/bridge/" target="_blank" rel="noopener noreferrer">bridge network</a>.</p><p>Ports on the <u>host&#39;s IPv6 addresses</u> will map to the <u>container&#39;s IPv4 address</u> if no host IP is given in a port mapping, the bridge network is IPv4-only, and <code>--userland-proxy=true</code> (default).</p><h5 id="_10-4-1-6-ip-address-and-hostname" tabindex="-1"><a class="header-anchor" href="#_10-4-1-6-ip-address-and-hostname"><span>10.4.1.6 IP address and hostname</span></a></h5><p>When creating a network, <strong>IPv4 address allocation is enabled by default</strong>, it can be disabled using <code>--ipv4=false</code>. IPv6 address allocation can be enabled using <code>--ipv6</code>.</p><div class="language-console line-numbers-mode" data-highlighter="shiki" data-ext="console" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> docker network create --ipv6 </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">--ipv4</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">false</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> v6net</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>By default, the container gets an IP address for every Docker network it attaches to. A container receives an IP address out of the IP subnet of the network. The Docker daemon performs dynamic subnetting and IP address allocation for containers. Each network also has a default subnet mask and gateway.</p><p>You can connect a running container to multiple networks, either by passing the <code>--network</code> flag multiple times when creating the container, or using the <code>docker network connect</code> command for already running containers. In both cases, you can use the <code>--ip</code> or <code>--ip6</code> flags to specify the container&#39;s IP address on that particular network.</p><p>In the same way, <strong>a container&#39;s hostname defaults to be the container&#39;s ID in Docker</strong>. You can override the hostname using <code>--hostname</code>. When connecting to an existing network using <code>docker network connect</code>, you can use the <code>--alias</code> flag to specify an additional network alias for the container on that network.</p><h5 id="_10-4-1-7-dns-services" tabindex="-1"><a class="header-anchor" href="#_10-4-1-7-dns-services"><span>10.4.1.7 DNS services</span></a></h5><p>Containers use <strong>the same DNS servers as the host</strong> by default, but you can override this with <code>--dns</code>.</p><p>By default, containers inherit the DNS settings as defined in the <code>/etc/resolv.conf</code> configuration file. Containers that attach to the default <code>bridge</code> network receive a copy of this file. <mark class="tip">Containers that attach to a custom network use <strong>Docker&#39;s embedded DNS server</strong></mark>.The embedded DNS server forwards external DNS lookups to the DNS servers configured on the host.</p><p>You can configure DNS resolution on a per-container basis, using flags for the <code>docker run</code> or <code>docker create</code> command used to start the container. The following table describes the available <code>docker run</code> flags related to DNS configuration.</p><table><thead><tr><th>Flag</th><th>Description</th></tr></thead><tbody><tr><td><code>--dns</code></td><td>The IP address of a DNS server. To specify multiple DNS servers, use multiple <code>--dns</code> flags. DNS requests will be forwarded from the container&#39;s network namespace so, for example, <code>--dns=127.0.0.1</code> refers to the container&#39;s own loopback address.</td></tr><tr><td><code>--dns-search</code></td><td>A DNS search domain to search non-fully qualified hostnames. To specify multiple DNS search prefixes, use multiple <code>--dns-search</code> flags.</td></tr><tr><td><code>--dns-opt</code></td><td>A key-value pair representing a DNS option and its value. See your operating system&#39;s documentation for <code>resolv.conf</code> for valid options.</td></tr><tr><td><code>--hostname</code></td><td>The hostname a container uses for itself. Defaults to the container&#39;s ID if not specified.</td></tr></tbody></table><h5 id="_10-4-1-8-custom-hosts" tabindex="-1"><a class="header-anchor" href="#_10-4-1-8-custom-hosts"><span>10.4.1.8 Custom hosts</span></a></h5>`,187)),e("p",null,[i[21]||(i[21]=s("Your container will have lines in ")),i[22]||(i[22]=e("code",null,"/etc/hosts",-1)),i[23]||(i[23]=s(" which define the hostname of the container itself, as well as ")),i[24]||(i[24]=e("code",null,"localhost",-1)),i[25]||(i[25]=s(" and a few other common things. Custom hosts, defined in ")),i[26]||(i[26]=e("code",null,"/etc/hosts",-1)),i[27]||(i[27]=s(" on the host machine, aren't inherited by containers. To pass additional hosts into a container, refer to ")),r(o,{to:"/Monthly%20in-depth%20topic/April&May-Docker/%5B/reference/cli/docker/container/run.html#add-host%5D(https://docs.docker.com/reference/cli/docker/container/run/#add-host)"},{default:a(()=>i[20]||(i[20]=[s("add entries to container hosts file")])),_:1}),i[28]||(i[28]=s(" in the ")),i[29]||(i[29]=e("code",null,"docker run",-1)),i[30]||(i[30]=s(" reference documentation."))]),i[45]||(i[45]=n(`<h5 id="_10-4-1-9-proxy-server" tabindex="-1"><a class="header-anchor" href="#_10-4-1-9-proxy-server"><span>10.4.1.9 Proxy server</span></a></h5><p>If your container needs to use a proxy server, see <a href="https://docs.docker.com/engine/daemon/proxy/" target="_blank" rel="noopener noreferrer">Use a proxy server</a>.</p><h4 id="_10-4-2-network-cli" tabindex="-1"><a class="header-anchor" href="#_10-4-2-network-cli"><span>10.4.2 Network CLI</span></a></h4><p>Refer to <a href="https://docs.docker.com/reference/cli/docker/network/" target="_blank" rel="noopener noreferrer">here</a> to view details about managing docker network.</p><h2 id="_11-developer-experience" tabindex="-1"><a class="header-anchor" href="#_11-developer-experience"><span>11. Developer Experience</span></a></h2><p>So far, we have focused primarily on getting our container images ready for deploying to production, and haven&#39;t focused on the <strong>developer experience</strong>.</p><p><strong>Key DevX Features</strong>:</p><ol><li><p><strong>Easy/simple to set up</strong>: Using <u>docker compose</u>, we can define the entire environment with a single yaml file. To get started, team members can issue a single command <code>make compose-up-build</code> or <code>make compose-up-build-debug</code> depending if they want to run the debugger or not.</p></li><li><p><strong>Ability to iterate without rebuilding the container image</strong>: In order to avoid having to rebuild the container image with every single change, we can use a <mark class="tip">bind mount to mount the code from our host into the container filesystem</mark>. For example:</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">- type: bind</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">source: ../05-example-web-application/api-node/</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">target: /usr/src/app/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>Automatic reloading of the application</strong>:</p><ul><li><u>React Client</u>: We are using <u>Vite</u> for the react client which handles this handles this automatically</li><li><u>Node API</u>: We added <u>nodemon</u> as a development dependency and specify the Docker CMD to use it</li><li><u>Golang API</u>: We added a utility called <u><a href="https://github.com/cosmtrek/air" target="_blank" rel="noopener noreferrer">air</a></u>within <u>Dockerfile.dev</u> which watches for changes and rebuild the app automatically.</li></ul></li><li><p><strong>Use a debugger</strong>:</p><ul><li><u>React Client</u>: For a react app, you can use the <u>browser developer tools + extensions</u> to debug. I did include <u>react-query-devtools</u> to help debug react query specific things. It is also viewed from within the browser.</li><li><u>Node API</u>: To enable debugging for a NodeJS application we can run the app with the <code>--inspect</code> flag. The debug session can then be accessed via a websocket on port <em>9229</em>. The additional considerations in this case are to specify that <u>the debugger listen for requests from 0.0.0.0 (any) and to publish port <em>9229</em> from the container to localhost</u>.</li><li>Golang API: To enable remote debugging for a golang application I installed a tool called <u><a href="https://github.com/go-delve/delve" target="_blank" rel="noopener noreferrer">delve</a></u> within <u>./api-golang/Dockerfile.dev</u>. We then override the command used to run the container to use this tool (see: <code>docker-compose-debug.yml</code>)</li></ul></li><li><p><strong>Executing tests</strong>: We also need the ability to execute our test suites within containers. Again, we can create a custom <code>docker-compose-test.yml</code> overlay which modifies the container commands to execute our tests. To build the api images and execute their tests, you can execute <code>make run-tests</code> which will use the <code>test</code> compose file along with the <code>dev</code> compose file to do so.</p></li><li><p><strong>Continuous integration pipeline for production images</strong></p></li><li><p><strong>Ephemeral environment for each pull request</strong></p></li></ol><h3 id="_11-1-hot-reloading" tabindex="-1"><a class="header-anchor" href="#_11-1-hot-reloading"><span>11.1 Hot Reloading</span></a></h3><p>Even with layer caching, we don&#39;t want to have to rebuild our container image with every code change. Instead, we want the state of our application in the container to reflect changes immediately. We can achieve this through <strong>a combination of bind mounts and hot reloading utilities</strong>!</p><p>The full <code>docker-compose.yml</code> file can be found <a href="https://github.com/sidpalas/devops-directive-docker-course/blob/main/11-development-workflow/docker-compose-dev.yml" target="_blank" rel="noopener noreferrer">here</a>.</p><h4 id="_11-1-1-react-frontend" tabindex="-1"><a class="header-anchor" href="#_11-1-1-react-frontend"><span>11.1.1 React Frontend</span></a></h4><p><strong>Vite</strong> is already designed to handle hot reloading, so all we need to do is <strong>bind mount our source code directory into the container at runtime</strong>.</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">volumes:</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  - type: bind</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    source: ../05-example-web-application/client-react/</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    target: /usr/src/app/</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  - type: volume</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    target: /usr/src/app/node_modules</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here we can see the source code location is mounted to the path we specified as <em>WORKDIR</em> in the <code>Dockerfile</code>.</p><p>We also add a second volume with <strong>NO</strong> source mounted to the location of the <code>node_modules</code> directory, just in case we have installed the node modules locally. This <u>takes precedence over the bind mount and prevents those unwanted files from being mounted in</u>.</p><h4 id="_11-1-2-node-api" tabindex="-1"><a class="header-anchor" href="#_11-1-2-node-api"><span>11.1.2 Node API</span></a></h4><p>We will be using <strong>nodemon</strong> to watch for changes and restart the node server.</p><p>First, install it as a development dependency:</p><div class="language-console line-numbers-mode" data-highlighter="shiki" data-ext="console" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">npm install --save-dev nodemon</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Then, refactor the Dockerfile to have a separate <strong>dev</strong> stage which includes development dependencies:</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> node:19.6-bullseye-slim </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">AS</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> base</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">WORKDIR</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> /usr/src/app</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">COPY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> package*.json ./</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#------------------------------------------------</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># Separate dev stage with nodemon and different CMD</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> base </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">as</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> dev</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">RUN</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> --mount=type=cache,target=/usr/src/app/.npm \\</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  npm set cache /usr/src/app/.npm &amp;&amp; \\</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  npm install</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">COPY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> . .</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># &quot;npm run dev&quot; corresponds to &quot;nodemon src/index.js&quot;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">CMD</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> [</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;npm&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">, </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;run&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">, </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;dev&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">]</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#------------------------------------------------</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> base </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">as</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> production</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">ENV</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> NODE_ENV production</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">RUN</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> --mount=type=cache,target=/usr/src/app/.npm \\</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  npm set cache /usr/src/app/.npm &amp;&amp; \\</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  npm ci --only=production</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">USER</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> node</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">COPY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> --chown=node:node ./src/ .</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">EXPOSE</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> 3000</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">CMD</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> [ </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;node&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">, </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;index.js&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>We then can specify the <strong>dev</strong> as the target for our <code>docker compose build</code> configuration and add the bind mount to our compose file:</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">build:</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  context: ../05-example-web-application/api-node/</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  dockerfile: ../../06-building-container-images/api-node/Dockerfile.9</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  target: dev</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">volumes:</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  - type: bind</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    source: ../05-example-web-application/api-node/</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    target: /usr/src/app/</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  - type: volume</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    target: /usr/src/app/node_modules</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>And our Node API will have hot reloading!</p><h4 id="_11-1-3-golang-api" tabindex="-1"><a class="header-anchor" href="#_11-1-3-golang-api"><span>11.1.3 Golang API</span></a></h4><p>Since golang is a compiled language, for hot reloading, <u>we actually need to recompile with each code change</u>. We will be using <strong>https://github.com/cosmtrek/air</strong> for this.</p><p>There is no concept of dev vs. production dependencies within the <code>go.mod</code> file, so we can update our Dockerfile to create a separate dev stage and install Air there:</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> golang:1.19-bullseye </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">AS</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> build-base</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">WORKDIR</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> /app</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">COPY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> go.mod go.sum ./</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">RUN</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> --mount=type=cache,target=/go/pkg/mod \\</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  --mount=type=cache,target=/root/.cache/go-build \\</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  go mod download</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#------------------------------------------------</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> build-base </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">AS</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> dev</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># Install air for hot reload &amp; delve for debugging</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">RUN</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> go install github.com/cosmtrek/air@latest &amp;&amp; \\</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  go install github.com/go-delve/delve/cmd/dlv@latest</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">COPY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> . .</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">CMD</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> [</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;air&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">, </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;-c&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">, </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;.air.toml&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">]</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#------------------------------------------------</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> build-base </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">AS</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> build-production</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">RUN</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> useradd -u 1001 nonroot</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">COPY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> . .</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">RUN</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> go build \\</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  -ldflags=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;-linkmode external -extldflags -static&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> \\</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  -tags netgo \\</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  -o api-golang</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> scratch</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">ENV</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> GIN_MODE=release</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">WORKDIR</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> /</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">COPY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> --from=build-production /etc/passwd /etc/passwd</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">COPY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> --from=build-production /app/healthcheck/healthcheck healthcheck</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">COPY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> --from=build-production /app/api-golang api-golang</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">USER</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> nonroot</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">EXPOSE</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> 8080</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">CMD</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> [</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;/api-golang&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>With this updated, we can <u>modify the docker compose to target the dev stage and bind mount the source code</u>:</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">build:</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  context: ../05-example-web-application/api-golang/</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  dockerfile: ../../06-building-container-images/api-golang/Dockerfile.8</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  target: dev</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">volumes:</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  - type: bind</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    source: ../05-example-web-application/api-golang/</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    target: /app/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_11-2-debuggers-in-docker" tabindex="-1"><a class="header-anchor" href="#_11-2-debuggers-in-docker"><span>11.2 Debuggers in Docker</span></a></h3><p>In order to make developing with containers competitive with developing locally, we need the ability to run and attach to debuggers inside the container.</p><h4 id="_11-2-1-aside-multiple-docker-compose-files" tabindex="-1"><a class="header-anchor" href="#_11-2-1-aside-multiple-docker-compose-files"><span>11.2.1 Aside: Multiple Docker Compose Files</span></a></h4><p>Docker compose has a nice feature that <strong>allows you to specify multiple docker compose files at runtime</strong>. This way you can <u>define a base configuration and a much smaller overlay with customizations</u>.</p><p>For example, lets say we had <code>docker-compose-a.yml</code>:</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">services:</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  my-service:</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    image: foobar</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>and <code>docker-compose-b.yml</code>:</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">services:</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  my-service:</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    command: [</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;echo&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">, </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;new command!&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>we can then issue the following <code>docker compose </code>command to run <code>my-service</code> with the updated command:</p><div class="language-docker line-numbers-mode" data-highlighter="shiki" data-ext="docker" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">docker compose -f docker-compose-a.yml -f docker-compose-b.yml run my-service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_11-2-2-debuggers" tabindex="-1"><a class="header-anchor" href="#_11-2-2-debuggers"><span>11.2.2 Debuggers</span></a></h4><p>As much as we all love sprinkling <code>console.log()</code> and <code>print()</code> statements, we need to be able to use real debuggers that enable us to set breakpoints, examine the runtime state of our code, etc...</p><h5 id="_11-2-2-1-node-api" tabindex="-1"><a class="header-anchor" href="#_11-2-2-1-node-api"><span>11.2.2.1 Node API</span></a></h5><p>NodeJS has a <u>built in debugger</u> we can activate using the <code>--inspect</code> flag. We can set up an NPM script to utilize this:</p><div class="language-npm line-numbers-mode" data-highlighter="shiki" data-ext="npm" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>&quot;debug-docker&quot;: &quot;nodemon --inspect=0.0.0.0:9229 ./src/index.js&quot;,</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>By default, <code>inspect</code> would only accept connections from localhost, but in this case we want to accept connections from outside of the container which is why we specify <code>0.0.0.0</code> (any host).</p><p>Now we can craft a compose overlay <code>docker-compose-debug.yml</code> to use this npm script and publish port 9229.</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">services:</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  api-node:</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    command:</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">      - </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;npm&quot;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">      - </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;run&quot;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">      - </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;debug-docker&quot;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    ports:</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">      - </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;3000:3000&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">      # inspect debug port</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">      - </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;9229:9229&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>With this configuration we can connect to the debugger listening on port 9229.</p><h5 id="_11-2-2-2-golang-api" tabindex="-1"><a class="header-anchor" href="#_11-2-2-2-golang-api"><span>11.2.2.2 Golang API</span></a></h5><p>In the previous lesson we added the following to our Dockerfile to install <a href="https://github.com/go-delve/delve" target="_blank" rel="noopener noreferrer">delve</a>, a golang debugger.</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">RUN</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> go install github.com/go-delve/delve/cmd/dlv@latest</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Combining this with a compose overlay:</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">services:</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  api-golang:</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    command:</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">      - </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;dlv&quot;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">      - </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;debug&quot;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">      - </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;/app/main.go&quot;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">      - </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;--listen=:4000&quot;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">      - </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;--headless=true&quot;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">      - </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;--log=true&quot;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">      - </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;--log-output=debugger,debuglineerr,gdbwire,lldbout,rpc&quot;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">      - </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;--accept-multiclient&quot;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">      - </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;--continue&quot;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">      - </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;--api-version=2&quot;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    ports:</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">      - </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;8080:8080&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">      # delve debug port</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">      - </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;4000:4000&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>We can run our remote debugger and connect to it on port 4000.</p><h5 id="_11-2-2-3-running-in-debug-mode" tabindex="-1"><a class="header-anchor" href="#_11-2-2-3-running-in-debug-mode"><span>11.2.2.3 Running in debug mode</span></a></h5><p>To use the updated configurations, run <code>docker compose up</code> with the <em>dev</em> and <em>debug</em> configurations together:</p><div class="language-docker line-numbers-mode" data-highlighter="shiki" data-ext="docker" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">docker-compose -f docker-compose-dev.yml -f docker-compose-debug.yml up --build</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>As discussed earlier, this command will interleave the configuration from both the <code>docker-compose-dev.yml</code> and <code>docker-compose-debug.yml </code>files.</p><h3 id="_11-3-tests" tabindex="-1"><a class="header-anchor" href="#_11-3-tests"><span>11.3 Tests</span></a></h3><p>We want to run tests in an environment as similar as possible to production, so it only makes sense to do so inside of our containers!</p><h4 id="_11-3-1-test-compose-file" tabindex="-1"><a class="header-anchor" href="#_11-3-1-test-compose-file"><span>11.3.1 Test compose file</span></a></h4><p>We will take advantage of the ability to <strong>specify multiple docker compose yaml files</strong> (as described in the previous section) to create a custom test configuration.</p><p>All we need to do is <mark class="tip">include commands to override the defaults</mark> that execute our test suite(s):</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">services:</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  api-node:</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    command:</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">      - </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;npm&quot;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">      - </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;run&quot;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">      - </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;test&quot;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  api-golang:</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    command:</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">      - </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;go&quot;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">      - </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;test&quot;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">      - </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;-v&quot;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">      - </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;./...&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_11-3-2-executing-tests" tabindex="-1"><a class="header-anchor" href="#_11-3-2-executing-tests"><span>11.3.2 Executing tests</span></a></h4><p>To execute the tests we can then run the following docker compose commands:</p><div class="language-console line-numbers-mode" data-highlighter="shiki" data-ext="console" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">docker-compose -f docker-compose-dev.yml -f docker-compose-test.yml run --rm api-node</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">docker-compose -f docker-compose-dev.yml -f docker-compose-test.yml run --rm api-golang</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>These commands will <strong>overlay the test configuration on the development configuration</strong>, run the tests for each service, and remove the containers after the tests are executed.</p><h3 id="_11-4-continuous-integration-ci" tabindex="-1"><a class="header-anchor" href="#_11-4-continuous-integration-ci"><span>11.4 Continuous Integration (CI)</span></a></h3><p>Continuous integration is the idea of <strong>executing some actions (for example build, test, etc...) automatically</strong> as you push code to your version control system.</p><p>For containers, there are a number of things we may want to do:</p><ol><li>Build the container images</li><li>Execute tests</li><li>Scan container images for vulnerabilities</li><li>Tag images with useful metadata</li><li>Push to a container registry</li></ol><h4 id="_11-4-1-github-actions" tabindex="-1"><a class="header-anchor" href="#_11-4-1-github-actions"><span>11.4.1 <strong>GitHub Actions</strong></span></a></h4><p>GitHub Actions is a continuous integration pipeline system built into GitHub.</p><p>You add configuration files to <strong>.github/workflows</strong> within the repo and GitHub will automatically execute them based on the conditions you set!</p><p>GitHub actions has a <a href="https://github.com/marketplace?type=actions" target="_blank" rel="noopener noreferrer">public marketplace</a> where people can publish open source actions that help make the process of writing your pipelines easier and faster. We will use a number of these actions as we build out a workflow for our repo.</p><h4 id="_11-4-2-execution-conditions" tabindex="-1"><a class="header-anchor" href="#_11-4-2-execution-conditions"><span>11.4.2 Execution conditions</span></a></h4><p>Common events used to trigger workflows include:</p><ul><li><u>Push events to one or more branches</u> (e.g. with each update to the <strong>main</strong> branch)</li><li>Creation of tags (e.g. tag that matches <strong>v</strong>* pattern indicating <strong>a release</strong>)</li><li>Pull request creation/modification (usually to execute tests)</li></ul><p>In this case we want to run our workflow on push events to the <strong>github-action</strong> branch and on any <strong>v</strong>* tags. To specify this we use the following yaml:</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">on</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  push</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    branches</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      -</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">github-action</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    tags</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      -</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">v*</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_11-4-3-build-tag-and-push" tabindex="-1"><a class="header-anchor" href="#_11-4-3-build-tag-and-push"><span>11.4.3 Build, Tag, and Push</span></a></h4><p>We can then specify one or more jobs. To keep things simple for the course I included a single job that will <u>build one of our container images, tag it, push it to Dockerhub, and scan it for vulnerabilities</u>.</p><p>The job is given a name and a specific machine type to run on.</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">jobs</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  build-tag-push</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    runs-on</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ubuntu-latest</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    steps</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      -</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> ...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>We then proceed through the following steps:</p><ol><li><p>Check out the code</p><p>A standard action which checks out the code from the repo at the relevant commit.</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">-</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Checkout</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  uses</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> actions/checkout@v3</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Generate image tags</p><p>Uses an action <u>from Docker</u> to generate useful tags based on information about the triggering event, the commit sha, and the current timestamp.</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">-</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Docker meta</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  id</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> meta</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  uses</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> docker/metadata-action@v4</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  with</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">      images</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> |</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">        sidpalas/devops-directive-docker-course-api-node</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">      tags</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> |</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">        type=raw,value=latest</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">        type=ref,event=branch</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">        type=ref,event=pr</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">        type=semver,pattern={{version}}</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">        type=semver,pattern={{major}}.{{minor}}</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">        type=raw,value={{date &#39;YYYYMMDD&#39;}}-{{sha}}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Login to DockerHub</p><p>Uses an action <u>from Docker + secrets</u> stored in the repo to authenticate to Dockerhub.</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">-</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Login to Docker Hub</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  uses</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> docker/login-action@v2</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  with</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    username</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> \${{ secrets.DOCKERHUB_USERNAME }}</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    password</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> \${{ secrets.DOCKERHUB_TOKEN }}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Build and push image</p><p>Use an action <u>from Docker along with the output of the tag generation step</u> to build and push the container image.</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">-</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Build and push</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  uses</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> docker/build-push-action@v4</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  with</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    file</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ./06-building-container-images/api-node/Dockerfile.8</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    context</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ./05-example-web-application/api-node/</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    push</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> true</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    tags</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> \${{ steps.meta.outputs.tags }}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Scan image for vulnerabilities</p><p>Use an action <u>from Trivy</u> to run their security scanner against the built image and fail if any <strong>CRITICAL</strong> level vulnerabilities are found.</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">-</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Run Trivy vulnerability scanner</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  uses</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> aquasecurity/trivy-action@master</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  with</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    image-ref</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">sidpalas/devops-directive-docker-course-api-node:latest</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    format</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">table</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    exit-code</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">1</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    ignore-unfixed</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> true</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    vuln-type</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">os,library</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    severity</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">CRITICAL</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h4 id="_11-4-4-additional-resources" tabindex="-1"><a class="header-anchor" href="#_11-4-4-additional-resources"><span>11.4.4 Additional Resources</span></a></h4><p>For more examples and advanced use cases of <strong>GitHub Actions and Docker CI/CD</strong>, check out Brett Fisher&#39;s <a href="https://github.com/BretFisher/docker-ci-automation" target="_blank" rel="noopener noreferrer">Docker CI/CD Automation repository</a>.</p><p>You can also watch his <a href="https://www.youtube.com/watch?v=aZzV6X7XhyI" target="_blank" rel="noopener noreferrer">talk</a> on the subject for a full walkthrough.</p><h2 id="_12-deploying-containers" tabindex="-1"><a class="header-anchor" href="#_12-deploying-containers"><span>12. Deploying Containers</span></a></h2><p>Deploying containers is a crucial step in using Docker and containerization to manage applications more efficiently, easily scale, and ensure consistent performance across environments. This topic will give you an overview of how to deploy Docker containers to create and run your applications.</p><h3 id="_12-1-nomad" tabindex="-1"><a class="header-anchor" href="#_12-1-nomad"><span>12.1 Nomad</span></a></h3><p>Refer to <a href="https://www.nomadproject.io/docs" target="_blank" rel="noopener noreferrer">here</a> to view details.</p><h3 id="_12-2-docker-swarm" tabindex="-1"><a class="header-anchor" href="#_12-2-docker-swarm"><span>12.2 Docker Swarm</span></a></h3><p>Docker Swarm is Docker’s native container orchestration tool that allows users to deploy, manage, and scale containers across a cluster of Docker hosts. By transforming a group of Docker nodes into a single, unified cluster, Swarm provides high availability, load balancing, and automated container scheduling using simple declarative commands. With features like service discovery, rolling updates, and integrated security through TLS encryption, Docker Swarm offers an approachable alternative to more complex orchestrators like Kubernetes. Its tight integration with the Docker CLI and ease of setup make it a suitable choice for small to medium-sized deployments where simplicity and straightforward management are priorities.</p><p>Refer to <a href="https://docs.docker.com/engine/swarm/" target="_blank" rel="noopener noreferrer">here</a> to view details.</p><h3 id="_12-3-kubernetes" tabindex="-1"><a class="header-anchor" href="#_12-3-kubernetes"><span>12.3 Kubernetes</span></a></h3><p>Kubernetes is an open-source container orchestration platform designed to automate the deployment, scaling, and management of containerized applications. It provides a robust framework for handling complex container workloads by organizing containers into logical units called pods, managing service discovery, load balancing, and scaling through declarative configurations. Kubernetes enables teams to deploy containers across clusters of machines, ensuring high availability and fault tolerance through self-healing capabilities like automatic restarts, replacements, and rollback mechanisms. With its extensive ecosystem and flexibility, Kubernetes has become the de facto standard for running large-scale, distributed applications, simplifying operations and improving the reliability of containerized workloads.</p><p>Refer to <a href="https://kubernetes.io/" target="_blank" rel="noopener noreferrer">here</a> to view details.</p><h3 id="_12-4-paas-options" tabindex="-1"><a class="header-anchor" href="#_12-4-paas-options"><span>12.4 PaaS Options</span></a></h3><p>Platform-as-a-Service (PaaS) options for deploying containers provide a simplified and managed environment where developers can build, deploy, and scale containerized applications without worrying about the underlying infrastructure. Popular PaaS offerings include Google Cloud Run, Azure App Service, AWS Elastic Beanstalk, and Heroku, which abstract away container orchestration complexities while offering automated scaling, easy integration with CI/CD pipelines, and monitoring capabilities. These platforms support rapid development and deployment by allowing teams to focus on application logic rather than server management, providing a seamless way to run containers in production with minimal operational overhead.</p><ul><li><a href="https://azure.microsoft.com/en-us/services/container-instances/" target="_blank" rel="noopener noreferrer">Azure Container Instances</a></li><li><a href="https://cloud.google.com/run" target="_blank" rel="noopener noreferrer">Google Cloud Run</a></li><li><a href="https://www.ibm.com/cloud/code-engine" target="_blank" rel="noopener noreferrer">IBM Cloud Code Engine</a></li><li><a href="https://aws.amazon.com/ecs/" target="_blank" rel="noopener noreferrer">Amazon Elastic Container Service</a></li></ul>`,105))])}const w=c(b,[["render",D]]),B=JSON.parse('{"path":"/article/yl6cv3xw/","title":"Docker","lang":"en-US","frontmatter":{"title":"Docker","createTime":"2025/06/15 13:43:26","permalink":"/article/yl6cv3xw/"},"readingTime":{"minutes":66.86,"words":20058},"git":{"updatedTime":1749994977000,"contributors":[{"name":"Nini","username":"Nini","email":"nwen@radioflyer.com","commits":15,"avatar":"https://avatars.githubusercontent.com/Nini?v=4","url":"https://github.com/Nini"}]},"filePathRelative":"Monthly in-depth topic/April&May-Docker/docker.md","headers":[],"categoryList":[{"id":"6abc3d","sort":10001,"name":"Monthly in-depth topic"},{"id":"6c65a1","sort":10003,"name":"April&May-Docker"}]}');export{w as comp,B as data};
